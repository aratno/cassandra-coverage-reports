<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractGettableByIndexData.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Cassandara Coverage Report</a> &gt; <a href="index.source.html" class="el_package">org.apache.cassandra.cql3.functions.types</a> &gt; <span class="el_source">AbstractGettableByIndexData.java</span></div><h1>AbstractGettableByIndexData.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.cassandra.cql3.functions.types;

import java.math.BigDecimal;
import java.math.BigInteger;
import java.net.InetAddress;
import java.nio.ByteBuffer;
import java.util.*;

import com.google.common.reflect.TypeToken;

import org.apache.cassandra.transport.ProtocolVersion;
import org.apache.cassandra.cql3.functions.types.exceptions.InvalidTypeException;

abstract class AbstractGettableByIndexData implements GettableByIndexData
{

    protected final ProtocolVersion protocolVersion;

    AbstractGettableByIndexData(ProtocolVersion protocolVersion)
<span class="nc" id="L37">    {</span>
<span class="nc" id="L38">        this.protocolVersion = protocolVersion;</span>
<span class="nc" id="L39">    }</span>

    /**
     * Returns the type for the value at index {@code i}.
     *
     * @param i the index of the type to fetch.
     * @return the type of the value at index {@code i}.
     * @throws IndexOutOfBoundsException if {@code i} is not a valid index.
     */
    protected abstract DataType getType(int i);

    /**
     * Returns the name corresponding to the value at index {@code i}.
     *
     * @param i the index of the name to fetch.
     * @return the name corresponding to the value at index {@code i}.
     * @throws IndexOutOfBoundsException if {@code i} is not a valid index.
     */
    protected abstract String getName(int i);

    /**
     * Returns the value at index {@code i}.
     *
     * @param i the index to fetch.
     * @return the value at index {@code i}.
     * @throws IndexOutOfBoundsException if {@code i} is not a valid index.
     */
    protected abstract ByteBuffer getValue(int i);

    protected abstract CodecRegistry getCodecRegistry();

    protected &lt;T&gt; TypeCodec&lt;T&gt; codecFor(int i)
    {
<span class="nc" id="L72">        return getCodecRegistry().codecFor(getType(i));</span>
    }

    protected &lt;T&gt; TypeCodec&lt;T&gt; codecFor(int i, Class&lt;T&gt; javaClass)
    {
<span class="nc" id="L77">        return getCodecRegistry().codecFor(getType(i), javaClass);</span>
    }

    protected &lt;T&gt; TypeCodec&lt;T&gt; codecFor(int i, TypeToken&lt;T&gt; javaType)
    {
<span class="nc" id="L82">        return getCodecRegistry().codecFor(getType(i), javaType);</span>
    }

    protected &lt;T&gt; TypeCodec&lt;T&gt; codecFor(int i, T value)
    {
<span class="nc" id="L87">        return getCodecRegistry().codecFor(getType(i), value);</span>
    }

    void checkType(int i, DataType.Name actual)
    {
<span class="nc" id="L92">        DataType.Name expected = getType(i).getName();</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (!actual.isCompatibleWith(expected))</span>
<span class="nc" id="L94">            throw new InvalidTypeException(</span>
<span class="nc" id="L95">            String.format(&quot;Value %s is of type %s, not %s&quot;, getName(i), expected, actual));</span>
<span class="nc" id="L96">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public boolean isNull(int i)
    {
<span class="nc bnc" id="L104" title="All 2 branches missed.">        return getValue(i) == null;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public boolean getBool(int i)
    {
<span class="nc" id="L113">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L114">        TypeCodec&lt;Boolean&gt; codec = codecFor(i, Boolean.class);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (codec instanceof TypeCodec.PrimitiveBooleanCodec)</span>
<span class="nc" id="L116">            return ((TypeCodec.PrimitiveBooleanCodec) codec).deserializeNoBoxing(value, protocolVersion);</span>
<span class="nc" id="L117">        else return codec.deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public byte getByte(int i)
    {
<span class="nc" id="L126">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L127">        TypeCodec&lt;Byte&gt; codec = codecFor(i, Byte.class);</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">        if (codec instanceof TypeCodec.PrimitiveByteCodec)</span>
<span class="nc" id="L129">            return ((TypeCodec.PrimitiveByteCodec) codec).deserializeNoBoxing(value, protocolVersion);</span>
<span class="nc" id="L130">        else return codec.deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public short getShort(int i)
    {
<span class="nc" id="L139">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L140">        TypeCodec&lt;Short&gt; codec = codecFor(i, Short.class);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">        if (codec instanceof TypeCodec.PrimitiveShortCodec)</span>
<span class="nc" id="L142">            return ((TypeCodec.PrimitiveShortCodec) codec).deserializeNoBoxing(value, protocolVersion);</span>
<span class="nc" id="L143">        else return codec.deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public int getInt(int i)
    {
<span class="nc" id="L152">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L153">        TypeCodec&lt;Integer&gt; codec = codecFor(i, Integer.class);</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if (codec instanceof TypeCodec.PrimitiveIntCodec)</span>
<span class="nc" id="L155">            return ((TypeCodec.PrimitiveIntCodec) codec).deserializeNoBoxing(value, protocolVersion);</span>
<span class="nc" id="L156">        else return codec.deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public long getLong(int i)
    {
<span class="nc" id="L165">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L166">        TypeCodec&lt;Long&gt; codec = codecFor(i, Long.class);</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (codec instanceof TypeCodec.PrimitiveLongCodec)</span>
<span class="nc" id="L168">            return ((TypeCodec.PrimitiveLongCodec) codec).deserializeNoBoxing(value, protocolVersion);</span>
<span class="nc" id="L169">        else return codec.deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public Date getTimestamp(int i)
    {
<span class="nc" id="L178">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L179">        return codecFor(i, Date.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public LocalDate getDate(int i)
    {
<span class="nc" id="L188">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L189">        return codecFor(i, LocalDate.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public long getTime(int i)
    {
<span class="nc" id="L198">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L199">        TypeCodec&lt;Long&gt; codec = codecFor(i, Long.class);</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (codec instanceof TypeCodec.PrimitiveLongCodec)</span>
<span class="nc" id="L201">            return ((TypeCodec.PrimitiveLongCodec) codec).deserializeNoBoxing(value, protocolVersion);</span>
<span class="nc" id="L202">        else return codec.deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public float getFloat(int i)
    {
<span class="nc" id="L211">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L212">        TypeCodec&lt;Float&gt; codec = codecFor(i, Float.class);</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">        if (codec instanceof TypeCodec.PrimitiveFloatCodec)</span>
<span class="nc" id="L214">            return ((TypeCodec.PrimitiveFloatCodec) codec).deserializeNoBoxing(value, protocolVersion);</span>
<span class="nc" id="L215">        else return codec.deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public double getDouble(int i)
    {
<span class="nc" id="L224">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L225">        TypeCodec&lt;Double&gt; codec = codecFor(i, Double.class);</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if (codec instanceof TypeCodec.PrimitiveDoubleCodec)</span>
<span class="nc" id="L227">            return ((TypeCodec.PrimitiveDoubleCodec) codec).deserializeNoBoxing(value, protocolVersion);</span>
<span class="nc" id="L228">        else return codec.deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public ByteBuffer getBytesUnsafe(int i)
    {
<span class="nc" id="L237">        ByteBuffer value = getValue(i);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (value == null) return null;</span>
<span class="nc" id="L239">        return value.duplicate();</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public ByteBuffer getBytes(int i)
    {
<span class="nc" id="L248">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L249">        return codecFor(i, ByteBuffer.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public String getString(int i)
    {
<span class="nc" id="L258">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L259">        return codecFor(i, String.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public BigInteger getVarint(int i)
    {
<span class="nc" id="L268">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L269">        return codecFor(i, BigInteger.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public BigDecimal getDecimal(int i)
    {
<span class="nc" id="L278">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L279">        return codecFor(i, BigDecimal.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public UUID getUUID(int i)
    {
<span class="nc" id="L288">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L289">        return codecFor(i, UUID.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public InetAddress getInet(int i)
    {
<span class="nc" id="L298">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L299">        return codecFor(i, InetAddress.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public &lt;T&gt; List&lt;T&gt; getList(int i, Class&lt;T&gt; elementsClass)
    {
<span class="nc" id="L309">        return getList(i, TypeToken.of(elementsClass));</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public &lt;T&gt; List&lt;T&gt; getList(int i, TypeToken&lt;T&gt; elementsType)
    {
<span class="nc" id="L319">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L320">        TypeToken&lt;List&lt;T&gt;&gt; javaType = TypeTokens.listOf(elementsType);</span>
<span class="nc" id="L321">        return codecFor(i, javaType).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public &lt;T&gt; Set&lt;T&gt; getSet(int i, Class&lt;T&gt; elementsClass)
    {
<span class="nc" id="L331">        return getSet(i, TypeToken.of(elementsClass));</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public &lt;T&gt; Set&lt;T&gt; getSet(int i, TypeToken&lt;T&gt; elementsType)
    {
<span class="nc" id="L341">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L342">        TypeToken&lt;Set&lt;T&gt;&gt; javaType = TypeTokens.setOf(elementsType);</span>
<span class="nc" id="L343">        return codecFor(i, javaType).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public &lt;K, V&gt; Map&lt;K, V&gt; getMap(int i, Class&lt;K&gt; keysClass, Class&lt;V&gt; valuesClass)
    {
<span class="nc" id="L353">        return getMap(i, TypeToken.of(keysClass), TypeToken.of(valuesClass));</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public &lt;K, V&gt; Map&lt;K, V&gt; getMap(int i, TypeToken&lt;K&gt; keysType, TypeToken&lt;V&gt; valuesType)
    {
<span class="nc" id="L363">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L364">        TypeToken&lt;Map&lt;K, V&gt;&gt; javaType = TypeTokens.mapOf(keysType, valuesType);</span>
<span class="nc" id="L365">        return codecFor(i, javaType).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public &lt;T&gt; List&lt;T&gt; getVector(int i, Class&lt;T&gt; elementsClass)
    {
<span class="nc" id="L375">        return getList(i, TypeToken.of(elementsClass));</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public &lt;T&gt; List&lt;T&gt; getVector(int i, TypeToken&lt;T&gt; elementsType)
    {
<span class="nc" id="L385">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L386">        TypeToken&lt;List&lt;T&gt;&gt; javaType = TypeTokens.listOf(elementsType);</span>
<span class="nc" id="L387">        return codecFor(i, javaType).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public UDTValue getUDTValue(int i)
    {
<span class="nc" id="L397">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L398">        return codecFor(i, UDTValue.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public TupleValue getTupleValue(int i)
    {
<span class="nc" id="L408">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L409">        return codecFor(i, TupleValue.class).deserialize(value, protocolVersion);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public Object getObject(int i)
    {
<span class="nc" id="L418">        return get(i, codecFor(i));</span>
    }

    @Override
    public &lt;T&gt; T get(int i, Class&lt;T&gt; targetClass)
    {
<span class="nc" id="L424">        return get(i, codecFor(i, targetClass));</span>
    }

    @Override
    public &lt;T&gt; T get(int i, TypeToken&lt;T&gt; targetType)
    {
<span class="nc" id="L430">        return get(i, codecFor(i, targetType));</span>
    }

    @Override
    public &lt;T&gt; T get(int i, TypeCodec&lt;T&gt; codec)
    {
<span class="nc" id="L436">        checkType(i, codec.getCqlType().getName());</span>
<span class="nc" id="L437">        ByteBuffer value = getValue(i);</span>
<span class="nc" id="L438">        return codec.deserialize(value, protocolVersion);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>IVerifier.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Cassandara Coverage Report</a> &gt; <a href="index.source.html" class="el_package">org.apache.cassandra.io.sstable</a> &gt; <span class="el_source">IVerifier.java</span></div><h1>IVerifier.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.cassandra.io.sstable;

import java.io.Closeable;
import java.util.Collection;
import java.util.function.Function;

import org.apache.cassandra.db.compaction.CompactionInfo;
import org.apache.cassandra.dht.Range;
import org.apache.cassandra.dht.Token;
import org.apache.cassandra.service.StorageService;

public interface IVerifier extends Closeable
{
    static Options.Builder options()
    {
<span class="fc" id="L34">        return new Options.Builder();</span>
    }

    void verify();

    @Override
    void close();

    CompactionInfo.Holder getVerifyInfo();

    class Options
    {
        public final boolean invokeDiskFailurePolicy;

        /**
         * Force extended verification - unless it is enabled, extended verificiation will be done only
         * if there is no digest present. Setting it along with quick makes no sense.
         */
        public final boolean extendedVerification;

        public final boolean checkVersion;
        public final boolean mutateRepairStatus;
        public final boolean checkOwnsTokens;

        /**
         * Quick check which does not include sstable data verification.
         */
        public final boolean quick;

        public final Function&lt;String, ? extends Collection&lt;Range&lt;Token&gt;&gt;&gt; tokenLookup;

        private Options(boolean invokeDiskFailurePolicy,
                        boolean extendedVerification,
                        boolean checkVersion,
                        boolean mutateRepairStatus,
                        boolean checkOwnsTokens,
                        boolean quick,
                        Function&lt;String, ? extends Collection&lt;Range&lt;Token&gt;&gt;&gt; tokenLookup)
<span class="fc" id="L72">        {</span>
<span class="fc" id="L73">            this.invokeDiskFailurePolicy = invokeDiskFailurePolicy;</span>
<span class="fc" id="L74">            this.extendedVerification = extendedVerification;</span>
<span class="fc" id="L75">            this.checkVersion = checkVersion;</span>
<span class="fc" id="L76">            this.mutateRepairStatus = mutateRepairStatus;</span>
<span class="fc" id="L77">            this.checkOwnsTokens = checkOwnsTokens;</span>
<span class="fc" id="L78">            this.quick = quick;</span>
<span class="fc" id="L79">            this.tokenLookup = tokenLookup;</span>
<span class="fc" id="L80">        }</span>

        @Override
        public String toString()
        {
<span class="fc" id="L85">            return &quot;Options{&quot; +</span>
                   &quot;invokeDiskFailurePolicy=&quot; + invokeDiskFailurePolicy +
                   &quot;, extendedVerification=&quot; + extendedVerification +
                   &quot;, checkVersion=&quot; + checkVersion +
                   &quot;, mutateRepairStatus=&quot; + mutateRepairStatus +
                   &quot;, checkOwnsTokens=&quot; + checkOwnsTokens +
                   &quot;, quick=&quot; + quick +
                   '}';
        }

<span class="fc" id="L95">        public static class Builder</span>
        {
<span class="fc" id="L97">            private boolean invokeDiskFailurePolicy = false; // invoking disk failure policy can stop the node if we find a corrupt stable</span>
<span class="fc" id="L98">            private boolean extendedVerification = false;</span>
<span class="fc" id="L99">            private boolean checkVersion = false;</span>
<span class="fc" id="L100">            private boolean mutateRepairStatus = false; // mutating repair status can be dangerous</span>
<span class="fc" id="L101">            private boolean checkOwnsTokens = false;</span>
<span class="fc" id="L102">            private boolean quick = false;</span>
<span class="fc" id="L103">            private Function&lt;String, ? extends Collection&lt;Range&lt;Token&gt;&gt;&gt; tokenLookup = StorageService.instance::getLocalAndPendingRanges;</span>

            public Builder invokeDiskFailurePolicy(boolean param)
            {
<span class="fc" id="L107">                this.invokeDiskFailurePolicy = param;</span>
<span class="fc" id="L108">                return this;</span>
            }

            public Builder extendedVerification(boolean param)
            {
<span class="fc" id="L113">                this.extendedVerification = param;</span>
<span class="fc" id="L114">                return this;</span>
            }

            public Builder checkVersion(boolean param)
            {
<span class="fc" id="L119">                this.checkVersion = param;</span>
<span class="fc" id="L120">                return this;</span>
            }

            public Builder mutateRepairStatus(boolean param)
            {
<span class="fc" id="L125">                this.mutateRepairStatus = param;</span>
<span class="fc" id="L126">                return this;</span>
            }

            public Builder checkOwnsTokens(boolean param)
            {
<span class="fc" id="L131">                this.checkOwnsTokens = param;</span>
<span class="fc" id="L132">                return this;</span>
            }

            public Builder quick(boolean param)
            {
<span class="fc" id="L137">                this.quick = param;</span>
<span class="fc" id="L138">                return this;</span>
            }

            public Builder tokenLookup(Function&lt;String, ? extends Collection&lt;Range&lt;Token&gt;&gt;&gt; tokenLookup)
            {
<span class="fc" id="L143">                this.tokenLookup = tokenLookup;</span>
<span class="fc" id="L144">                return this;</span>
            }

            public Options build()
            {
<span class="fc" id="L149">                return new Options(invokeDiskFailurePolicy, extendedVerification, checkVersion, mutateRepairStatus, checkOwnsTokens, quick, tokenLookup);</span>
            }
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>
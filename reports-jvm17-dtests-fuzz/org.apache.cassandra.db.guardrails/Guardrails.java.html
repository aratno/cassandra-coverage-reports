<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Guardrails.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Cassandara Coverage Report</a> &gt; <a href="index.source.html" class="el_package">org.apache.cassandra.db.guardrails</a> &gt; <span class="el_source">Guardrails.java</span></div><h1>Guardrails.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.cassandra.db.guardrails;

import java.util.Collections;
import java.util.Set;
import java.util.function.Function;
import java.util.stream.Collectors;
import javax.annotation.Nullable;

import com.google.common.annotations.VisibleForTesting;
import com.google.common.collect.ImmutableSet;
import org.apache.commons.lang3.StringUtils;

import org.apache.cassandra.config.CassandraRelevantProperties;
import org.apache.cassandra.config.DataStorageSpec;
import org.apache.cassandra.config.DatabaseDescriptor;
import org.apache.cassandra.config.DurationSpec;
import org.apache.cassandra.config.GuardrailsOptions;
import org.apache.cassandra.db.ConsistencyLevel;
import org.apache.cassandra.db.compaction.TimeWindowCompactionStrategy;
import org.apache.cassandra.locator.InetAddressAndPort;
import org.apache.cassandra.service.ClientState;
import org.apache.cassandra.service.disk.usage.DiskUsageBroadcaster;
import org.apache.cassandra.utils.MBeanWrapper;

import static java.lang.String.format;

/**
 * Entry point for Guardrails, storing the defined guardrails and providing a few global methods over them.
 */
public final class Guardrails implements GuardrailsMBean
{
    public static final String MBEAN_NAME = &quot;org.apache.cassandra.db:type=Guardrails&quot;;

<span class="fc" id="L52">    public static final GuardrailsConfigProvider CONFIG_PROVIDER = GuardrailsConfigProvider.instance;</span>
<span class="fc" id="L53">    private static final GuardrailsOptions DEFAULT_CONFIG = DatabaseDescriptor.getGuardrailsConfig();</span>

    @VisibleForTesting
<span class="fc" id="L56">    public static final Guardrails instance = new Guardrails();</span>

    /**
     * Guardrail on the total number of user keyspaces.
     */
<span class="fc" id="L61">    public static final MaxThreshold keyspaces =</span>
    new MaxThreshold(&quot;keyspaces&quot;,
                     null,
<span class="nc" id="L64">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getKeyspacesWarnThreshold(),</span>
<span class="nc" id="L65">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getKeyspacesFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L67" title="All 2 branches missed.">                     isWarning ? format(&quot;Creating keyspace %s, current number of keyspaces %s exceeds warning threshold of %s.&quot;,</span>
                                        what, value, threshold)
<span class="nc" id="L69">                               : format(&quot;Cannot have more than %s keyspaces, aborting the creation of keyspace %s&quot;,</span>
                                        threshold, what));

    /**
     * Guardrail on the total number of tables on user keyspaces.
     */
<span class="fc" id="L75">    public static final MaxThreshold tables =</span>
    new MaxThreshold(&quot;tables&quot;,
                     null,
<span class="nc" id="L78">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getTablesWarnThreshold(),</span>
<span class="nc" id="L79">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getTablesFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L81" title="All 2 branches missed.">                     isWarning ? format(&quot;Creating table %s, current number of tables %s exceeds warning threshold of %s.&quot;,</span>
                                        what, value, threshold)
<span class="nc" id="L83">                               : format(&quot;Cannot have more than %s tables, aborting the creation of table %s&quot;,</span>
                                        threshold, what));

    /**
     * Guardrail on the number of columns per table.
     */
<span class="fc" id="L89">    public static final MaxThreshold columnsPerTable =</span>
    new MaxThreshold(&quot;columns_per_table&quot;,
                     null,
<span class="nc" id="L92">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getColumnsPerTableWarnThreshold(),</span>
<span class="nc" id="L93">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getColumnsPerTableFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L95" title="All 2 branches missed.">                     isWarning ? format(&quot;The table %s has %s columns, this exceeds the warning threshold of %s.&quot;,</span>
                                        what, value, threshold)
<span class="nc" id="L97">                               : format(&quot;Tables cannot have more than %s columns, but %s provided for table %s&quot;,</span>
                                        threshold, value, what));

<span class="fc" id="L100">    public static final MaxThreshold secondaryIndexesPerTable =</span>
    new MaxThreshold(&quot;secondary_indexes_per_table&quot;,
                     null,
<span class="nc" id="L103">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getSecondaryIndexesPerTableWarnThreshold(),</span>
<span class="nc" id="L104">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getSecondaryIndexesPerTableFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L106" title="All 2 branches missed.">                     isWarning ? format(&quot;Creating secondary index %s, current number of indexes %s exceeds warning threshold of %s.&quot;,</span>
                                        what, value, threshold)
<span class="nc" id="L108">                               : format(&quot;Tables cannot have more than %s secondary indexes, aborting the creation of secondary index %s&quot;,</span>
                                        threshold, what));

    /**
     * Guardrail disabling user's ability to create secondary indexes
     */
<span class="fc" id="L114">    public static final EnableFlag createSecondaryIndexesEnabled =</span>
    new EnableFlag(&quot;secondary_indexes&quot;,
                   null,
<span class="nc" id="L117">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getSecondaryIndexesEnabled(),</span>
                   &quot;User creation of secondary indexes&quot;);

    /**
     * Guardrail on the number of materialized views per table.
     */
<span class="fc" id="L123">    public static final MaxThreshold materializedViewsPerTable =</span>
    new MaxThreshold(&quot;materialized_views_per_table&quot;,
                     null,
<span class="nc" id="L126">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getMaterializedViewsPerTableWarnThreshold(),</span>
<span class="nc" id="L127">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getMaterializedViewsPerTableFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L129" title="All 2 branches missed.">                     isWarning ? format(&quot;Creating materialized view %s, current number of views %s exceeds warning threshold of %s.&quot;,</span>
                                        what, value, threshold)
<span class="nc" id="L131">                               : format(&quot;Tables cannot have more than %s materialized views, aborting the creation of materialized view %s&quot;,</span>
                                        threshold, what));

    /**
     * Guardrail warning about, ignoring or rejecting the usage of certain table properties.
     */
<span class="fc" id="L137">    public static final Values&lt;String&gt; tableProperties =</span>
    new Values&lt;&gt;(&quot;table_properties&quot;,
                 null,
<span class="nc" id="L140">                 state -&gt; CONFIG_PROVIDER.getOrCreate(state).getTablePropertiesWarned(),</span>
<span class="nc" id="L141">                 state -&gt; CONFIG_PROVIDER.getOrCreate(state).getTablePropertiesIgnored(),</span>
<span class="nc" id="L142">                 state -&gt; CONFIG_PROVIDER.getOrCreate(state).getTablePropertiesDisallowed(),</span>
                 &quot;Table Properties&quot;);

    /**
     * Guardrail disabling user-provided timestamps.
     */
<span class="fc" id="L148">    public static final EnableFlag userTimestampsEnabled =</span>
    new EnableFlag(&quot;user_timestamps&quot;,
                   null,
<span class="nc" id="L151">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getUserTimestampsEnabled(),</span>
                   &quot;User provided timestamps (USING TIMESTAMP)&quot;);

<span class="fc" id="L154">    public static final EnableFlag groupByEnabled =</span>
    new EnableFlag(&quot;group_by&quot;,
                   null,
<span class="nc" id="L157">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getGroupByEnabled(),</span>
                   &quot;GROUP BY functionality&quot;);

    /**
     * Guardrail disabling ALTER TABLE column mutation access.
     */
<span class="fc" id="L163">    public static final EnableFlag alterTableEnabled =</span>
    new EnableFlag(&quot;alter_table&quot;,
                   null,
<span class="nc" id="L166">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getAlterTableEnabled(),</span>
                   &quot;User access to ALTER TABLE statement for column mutation&quot;);

    /**
     * Guardrail disabling DROP / TRUNCATE TABLE behavior
     */
<span class="fc" id="L172">    public static final EnableFlag dropTruncateTableEnabled =</span>
    new EnableFlag(&quot;drop_truncate_table_enabled&quot;,
                   null,
<span class="nc" id="L175">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getDropTruncateTableEnabled(),</span>
                   &quot;DROP and TRUNCATE TABLE functionality&quot;);

    /**
     * Guardrail disabling DROP KEYSPACE behavior
     */
<span class="fc" id="L181">    public static final EnableFlag dropKeyspaceEnabled =</span>
    new EnableFlag(&quot;drop_keyspace_enabled&quot;,
                    null,
<span class="nc" id="L184">                    state -&gt; CONFIG_PROVIDER.getOrCreate(state).getDropKeyspaceEnabled(),</span>
                    &quot;DROP KEYSPACE functionality&quot;);

    /**
     * Guardrail disabling bulk loading of SSTables
     */
<span class="fc" id="L190">    public static final EnableFlag bulkLoadEnabled =</span>
    (EnableFlag) new EnableFlag(&quot;bulk_load_enabled&quot;,
                   &quot;Bulk loading of SSTables might potentially destabilize the node.&quot;,
<span class="nc" id="L193">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getBulkLoadEnabled(),</span>
<span class="fc" id="L194">                   &quot;Bulk loading of SSTables&quot;).throwOnNullClientState(true);</span>

    /**
     * Guardrail disabling user's ability to turn off compression
     */
<span class="fc" id="L199">    public static final EnableFlag uncompressedTablesEnabled =</span>
    new EnableFlag(&quot;uncompressed_tables_enabled&quot;,
                   null,
<span class="nc" id="L202">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getUncompressedTablesEnabled(),</span>
                   &quot;Uncompressed table&quot;);

    /**
     * Guardrail disabling the creation of new COMPACT STORAGE tables
     */
<span class="fc" id="L208">    public static final EnableFlag compactTablesEnabled =</span>
    new EnableFlag(&quot;compact_tables&quot;,
                   null,
<span class="nc" id="L211">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getCompactTablesEnabled(),</span>
                   &quot;Creation of new COMPACT STORAGE tables&quot;);

    /**
     * Guardrail to warn or fail a CREATE or ALTER TABLE statement when default_time_to_live is set to 0 and
     * the table is using TimeWindowCompactionStrategy compaction or a subclass of it.
     */
<span class="fc" id="L218">    public static final EnableFlag zeroTTLOnTWCSEnabled =</span>
    new EnableFlag(&quot;zero_ttl_on_twcs&quot;,
                   &quot;It is suspicious to use default_time_to_live set to 0 with such compaction strategy. &quot; +
                   &quot;Please keep in mind that data will not start to automatically expire after they are older &quot; +
                   &quot;than a respective compaction window unit of a certain size. Please set TTL for your INSERT or UPDATE &quot; +
                   &quot;statements if you expect data to be expired as table settings will not do it. &quot;,
<span class="nc" id="L224">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getZeroTTLOnTWCSWarned(),</span>
<span class="nc" id="L225">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getZeroTTLOnTWCSEnabled(),</span>
<span class="fc" id="L226">                   &quot;0 default_time_to_live on a table with &quot; + TimeWindowCompactionStrategy.class.getSimpleName() + &quot; compaction strategy&quot;);</span>

    /**
     * Guardrail on the number of elements returned within page.
     */
<span class="fc" id="L231">    public static final MaxThreshold pageSize =</span>
    new MaxThreshold(&quot;page_size&quot;,
                     null,
<span class="nc" id="L234">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getPageSizeWarnThreshold(),</span>
<span class="nc" id="L235">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getPageSizeFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L237" title="All 2 branches missed.">                     isWarning ? format(&quot;Query for table %s with page size %s exceeds warning threshold of %s.&quot;,</span>
                                        what, value, threshold)
<span class="nc" id="L239">                               : format(&quot;Aborting query for table %s, page size %s exceeds fail threshold of %s.&quot;,</span>
                                        what, value, threshold));

    /**
     * Guardrail on the number of partition keys in the IN clause.
     */
<span class="fc" id="L245">    public static final MaxThreshold partitionKeysInSelect =</span>
    new MaxThreshold(&quot;partition_keys_in_select&quot;,
                     null,
<span class="nc" id="L248">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getPartitionKeysInSelectWarnThreshold(),</span>
<span class="nc" id="L249">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getPartitionKeysInSelectFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L251" title="All 2 branches missed.">                     isWarning ? format(&quot;Query with partition keys in IN clause on table %s, with number of &quot; +</span>
                                        &quot;partition keys %s exceeds warning threshold of %s.&quot;,
                                        what, value, threshold)
<span class="nc" id="L254">                               : format(&quot;Aborting query with partition keys in IN clause on table %s, &quot; +</span>
                                        &quot;number of partition keys %s exceeds fail threshold of %s.&quot;,
                                        what, value, threshold));

    /**
     * Guardrail disabling operations on lists that require read before write.
     */
<span class="fc" id="L261">    public static final EnableFlag readBeforeWriteListOperationsEnabled =</span>
    new EnableFlag(&quot;read_before_write_list_operations&quot;,
                   null,
<span class="nc" id="L264">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getReadBeforeWriteListOperationsEnabled(),</span>
                   &quot;List operation requiring read before write&quot;);

    /**
     * Guardrail disabling ALLOW FILTERING statement within a query
     */
<span class="fc" id="L270">    public static final EnableFlag allowFilteringEnabled =</span>
    new EnableFlag(&quot;allow_filtering&quot;,
                   &quot;ALLOW FILTERING can potentially visit all the data in the table and have unpredictable performance.&quot;,
<span class="nc" id="L273">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getAllowFilteringEnabled(),</span>
                   &quot;Querying with ALLOW FILTERING&quot;);

    /**
     * Guardrail disabling setting SimpleStrategy via keyspace creation or alteration
     */
<span class="fc" id="L279">    public static final EnableFlag simpleStrategyEnabled =</span>
    new EnableFlag(&quot;simplestrategy&quot;,
                   null,
<span class="nc" id="L282">                   state -&gt; CONFIG_PROVIDER.getOrCreate(state).getSimpleStrategyEnabled(),</span>
                   &quot;SimpleStrategy&quot;);

    /**
     * Guardrail on the number of restrictions created by a cartesian product of a CQL's {@code IN} query.
     */
<span class="fc" id="L288">    public static final MaxThreshold inSelectCartesianProduct =</span>
    new MaxThreshold(&quot;in_select_cartesian_product&quot;,
                     null,
<span class="nc" id="L291">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getInSelectCartesianProductWarnThreshold(),</span>
<span class="nc" id="L292">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getInSelectCartesianProductFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L294" title="All 2 branches missed.">                     isWarning ? format(&quot;The cartesian product of the IN restrictions on %s produces %s values, &quot; +</span>
                                        &quot;this exceeds warning threshold of %s.&quot;,
                                        what, value, threshold)
<span class="nc" id="L297">                               : format(&quot;Aborting query because the cartesian product of the IN restrictions on %s &quot; +</span>
                                        &quot;produces %s values, this exceeds fail threshold of %s.&quot;,
                                        what, value, threshold));

    /**
     * Guardrail on read consistency levels.
     */
<span class="fc" id="L304">    public static final Values&lt;ConsistencyLevel&gt; readConsistencyLevels =</span>
    new Values&lt;&gt;(&quot;read_consistency_levels&quot;,
                 null,
<span class="nc" id="L307">                 state -&gt; CONFIG_PROVIDER.getOrCreate(state).getReadConsistencyLevelsWarned(),</span>
<span class="nc" id="L308">                 state -&gt; Collections.emptySet(),</span>
<span class="nc" id="L309">                 state -&gt; CONFIG_PROVIDER.getOrCreate(state).getReadConsistencyLevelsDisallowed(),</span>
                 &quot;read consistency levels&quot;);

    /**
     * Guardrail on write consistency levels.
     */
<span class="fc" id="L315">    public static final Values&lt;ConsistencyLevel&gt; writeConsistencyLevels =</span>
    new Values&lt;&gt;(&quot;write_consistency_levels&quot;,
                 null,
<span class="nc" id="L318">                 state -&gt; CONFIG_PROVIDER.getOrCreate(state).getWriteConsistencyLevelsWarned(),</span>
<span class="nc" id="L319">                 state -&gt; Collections.emptySet(),</span>
<span class="nc" id="L320">                 state -&gt; CONFIG_PROVIDER.getOrCreate(state).getWriteConsistencyLevelsDisallowed(),</span>
                 &quot;write consistency levels&quot;);

    /**
     * Guardrail on the size of a partition.
     */
<span class="fc" id="L326">    public static final MaxThreshold partitionSize =</span>
    new MaxThreshold(&quot;partition_size&quot;,
                     &quot;Too large partitions can cause performance problems.&quot;,
<span class="fc" id="L329">                     state -&gt; sizeToBytes(CONFIG_PROVIDER.getOrCreate(state).getPartitionSizeWarnThreshold()),</span>
<span class="fc" id="L330">                     state -&gt; sizeToBytes(CONFIG_PROVIDER.getOrCreate(state).getPartitionSizeFailThreshold()),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L332">                             format(&quot;Partition %s has size %s, this exceeds the %s threshold of %s.&quot;,</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">                                    what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

    /**
     * Guardrail on the number of rows of a partition.
     */
<span class="fc" id="L338">    public static final MaxThreshold partitionTombstones =</span>
    new MaxThreshold(&quot;partition_tombstones&quot;,
                     &quot;Partitions with too many tombstones can cause performance problems.&quot;,
<span class="fc" id="L341">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getPartitionTombstonesWarnThreshold(),</span>
<span class="fc" id="L342">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getPartitionTombstonesFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L344">                             format(&quot;Partition %s has %s tombstones, this exceeds the %s threshold of %s.&quot;,</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">                                    what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

    /**
     * Guardrail on the size of a collection.
     */
<span class="fc" id="L350">    public static final MaxThreshold columnValueSize =</span>
    new MaxThreshold(&quot;column_value_size&quot;,
                     null,
<span class="nc" id="L353">                     state -&gt; sizeToBytes(CONFIG_PROVIDER.getOrCreate(state).getColumnValueSizeWarnThreshold()),</span>
<span class="nc" id="L354">                     state -&gt; sizeToBytes(CONFIG_PROVIDER.getOrCreate(state).getColumnValueSizeFailThreshold()),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L356">                     format(&quot;Value of column %s has size %s, this exceeds the %s threshold of %s.&quot;,</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">                            what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

    /**
     * Guardrail on the size of a collection.
     */
<span class="fc" id="L362">    public static final MaxThreshold collectionSize =</span>
    new MaxThreshold(&quot;collection_size&quot;,
                     null,
<span class="fc" id="L365">                     state -&gt; sizeToBytes(CONFIG_PROVIDER.getOrCreate(state).getCollectionSizeWarnThreshold()),</span>
<span class="fc" id="L366">                     state -&gt; sizeToBytes(CONFIG_PROVIDER.getOrCreate(state).getCollectionSizeFailThreshold()),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L368">                     format(&quot;Detected collection %s of size %s, this exceeds the %s threshold of %s.&quot;,</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">                            what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

    /**
     * Guardrail on the number of items of a collection.
     */
<span class="fc" id="L374">    public static final MaxThreshold itemsPerCollection =</span>
    new MaxThreshold(&quot;items_per_collection&quot;,
                     null,
<span class="fc" id="L377">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getItemsPerCollectionWarnThreshold(),</span>
<span class="fc" id="L378">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getItemsPerCollectionFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L380">                     format(&quot;Detected collection %s with %s items, this exceeds the %s threshold of %s.&quot;,</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">                            what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

    /**
     * Guardrail on the number of fields on each UDT.
     */
<span class="fc" id="L386">    public static final MaxThreshold fieldsPerUDT =</span>
    new MaxThreshold(&quot;fields_per_udt&quot;,
                     null,
<span class="nc" id="L389">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getFieldsPerUDTWarnThreshold(),</span>
<span class="nc" id="L390">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getFieldsPerUDTFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L392" title="All 2 branches missed.">                     isWarning ? format(&quot;The user type %s has %s columns, this exceeds the warning threshold of %s.&quot;,</span>
                                        what, value, threshold)
<span class="nc" id="L394">                               : format(&quot;User types cannot have more than %s columns, but %s provided for user type %s.&quot;,</span>
                                        threshold, value, what));

    /**
     * Guardrail on the number of dimensions of vector columns.
     */
<span class="fc" id="L400">    public static final MaxThreshold vectorDimensions =</span>
    new MaxThreshold(&quot;vector_dimensions&quot;,
                     null,
<span class="nc" id="L403">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getVectorDimensionsWarnThreshold(),</span>
<span class="nc" id="L404">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getVectorDimensionsFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L406">                     format(&quot;%s has a vector of %s dimensions, this exceeds the %s threshold of %s.&quot;,</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">                            what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

    /**
     * Guardrail on the data disk usage on the local node, used by a periodic task to calculate and propagate that status.
     * See {@link org.apache.cassandra.service.disk.usage.DiskUsageMonitor} and {@link DiskUsageBroadcaster}.
     */
<span class="fc" id="L413">    public static final PercentageThreshold localDataDiskUsage =</span>
    new PercentageThreshold(&quot;local_data_disk_usage&quot;,
                            null,
<span class="nc" id="L416">                            state -&gt; CONFIG_PROVIDER.getOrCreate(state).getDataDiskUsagePercentageWarnThreshold(),</span>
<span class="nc" id="L417">                            state -&gt; CONFIG_PROVIDER.getOrCreate(state).getDataDiskUsagePercentageFailThreshold(),</span>
                            (isWarning, what, value, threshold) -&gt;
<span class="nc bnc" id="L419" title="All 2 branches missed.">                            isWarning ? format(&quot;Local data disk usage %s(%s) exceeds warning threshold of %s&quot;,</span>
                                               value, what, threshold)
<span class="nc" id="L421">                                      : format(&quot;Local data disk usage %s(%s) exceeds failure threshold of %s, &quot; +</span>
                                               &quot;will stop accepting writes&quot;,
                                               value, what, threshold));

    /**
     * Guardrail on the data disk usage on replicas, used at write time to verify the status of the involved replicas.
     * See {@link org.apache.cassandra.service.disk.usage.DiskUsageMonitor} and {@link DiskUsageBroadcaster}.
     */
<span class="fc" id="L429">    public static final Predicates&lt;InetAddressAndPort&gt; replicaDiskUsage =</span>
    new Predicates&lt;&gt;(&quot;replica_disk_usage&quot;,
                     null,
<span class="nc" id="L432">                     state -&gt; DiskUsageBroadcaster.instance::isStuffed,</span>
<span class="nc" id="L433">                     state -&gt; DiskUsageBroadcaster.instance::isFull,</span>
                     // not using `value` because it represents replica address which should be hidden from client.
                     (isWarning, value) -&gt;
<span class="nc bnc" id="L436" title="All 2 branches missed.">                     isWarning ? &quot;Replica disk usage exceeds warning threshold&quot;</span>
<span class="nc" id="L437">                               : &quot;Write request failed because disk usage exceeds failure threshold&quot;);</span>

    static
    {
        // Avoid spamming with notifications about stuffed/full disks
<span class="fc" id="L442">        long minNotifyInterval = CassandraRelevantProperties.DISK_USAGE_NOTIFY_INTERVAL_MS.getLong();</span>
<span class="fc" id="L443">        localDataDiskUsage.minNotifyIntervalInMs(minNotifyInterval);</span>
<span class="fc" id="L444">        replicaDiskUsage.minNotifyIntervalInMs(minNotifyInterval);</span>
    }

    /**
     * Guardrail on the minimum replication factor.
     */
<span class="fc" id="L450">    public static final MinThreshold minimumReplicationFactor =</span>
    new MinThreshold(&quot;minimum_replication_factor&quot;,
                     null,
<span class="nc" id="L453">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getMinimumReplicationFactorWarnThreshold(),</span>
<span class="nc" id="L454">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getMinimumReplicationFactorFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L456">                     format(&quot;The keyspace %s has a replication factor of %s, below the %s threshold of %s.&quot;,</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">                            what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

    /**
     * Guardrail on the maximum replication factor.
     */
<span class="fc" id="L462">    public static final MaxThreshold maximumReplicationFactor =</span>
    new MaxThreshold(&quot;maximum_replication_factor&quot;,
                     null,
<span class="nc" id="L465">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getMaximumReplicationFactorWarnThreshold(),</span>
<span class="nc" id="L466">                     state -&gt; CONFIG_PROVIDER.getOrCreate(state).getMaximumReplicationFactorFailThreshold(),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L468">                     format(&quot;The keyspace %s has a replication factor of %s, above the %s threshold of %s.&quot;,</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">                            what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

<span class="fc" id="L471">    public static final MaxThreshold maximumAllowableTimestamp =</span>
    new MaxThreshold(&quot;maximum_timestamp&quot;,
                     &quot;Timestamps too far in the future can lead to data that can't be easily overwritten&quot;,
<span class="nc" id="L474">                     state -&gt; maximumTimestampAsRelativeMicros(CONFIG_PROVIDER.getOrCreate(state).getMaximumTimestampWarnThreshold()),</span>
<span class="nc" id="L475">                     state -&gt; maximumTimestampAsRelativeMicros(CONFIG_PROVIDER.getOrCreate(state).getMaximumTimestampFailThreshold()),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L477">                    format(&quot;The modification to table %s has a timestamp %s after the maximum allowable %s threshold %s&quot;,</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">                           what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

<span class="fc" id="L480">    public static final MinThreshold minimumAllowableTimestamp =</span>
    new MinThreshold(&quot;minimum_timestamp&quot;,
                     &quot;Timestamps too far in the past can cause writes can be unexpectedly lost&quot;,
<span class="nc" id="L483">                     state -&gt; minimumTimestampAsRelativeMicros(CONFIG_PROVIDER.getOrCreate(state).getMinimumTimestampWarnThreshold()),</span>
<span class="nc" id="L484">                     state -&gt; minimumTimestampAsRelativeMicros(CONFIG_PROVIDER.getOrCreate(state).getMinimumTimestampFailThreshold()),</span>
                     (isWarning, what, value, threshold) -&gt;
<span class="nc" id="L486">                     format(&quot;The modification to table %s has a timestamp %s before the minimum allowable %s threshold %s&quot;,</span>
<span class="nc bnc" id="L487" title="All 2 branches missed.">                            what, value, isWarning ? &quot;warning&quot; : &quot;failure&quot;, threshold));</span>

    private Guardrails()
<span class="fc" id="L490">    {</span>
<span class="fc" id="L491">        MBeanWrapper.instance.registerMBean(this, MBEAN_NAME);</span>
<span class="fc" id="L492">    }</span>

    @Override
    public int getKeyspacesWarnThreshold()
    {
<span class="nc" id="L497">        return DEFAULT_CONFIG.getKeyspacesWarnThreshold();</span>
    }

    @Override
    public int getKeyspacesFailThreshold()
    {
<span class="nc" id="L503">        return DEFAULT_CONFIG.getKeyspacesFailThreshold();</span>
    }

    @Override
    public void setKeyspacesThreshold(int warn, int fail)
    {
<span class="nc" id="L509">        DEFAULT_CONFIG.setKeyspacesThreshold(warn, fail);</span>
<span class="nc" id="L510">    }</span>

    @Override
    public int getTablesWarnThreshold()
    {
<span class="nc" id="L515">        return DEFAULT_CONFIG.getTablesWarnThreshold();</span>
    }

    @Override
    public int getTablesFailThreshold()
    {
<span class="nc" id="L521">        return DEFAULT_CONFIG.getTablesFailThreshold();</span>
    }

    @Override
    public void setTablesThreshold(int warn, int fail)
    {
<span class="nc" id="L527">        DEFAULT_CONFIG.setTablesThreshold(warn, fail);</span>
<span class="nc" id="L528">    }</span>

    @Override
    public int getColumnsPerTableWarnThreshold()
    {
<span class="nc" id="L533">        return DEFAULT_CONFIG.getColumnsPerTableWarnThreshold();</span>
    }

    @Override
    public int getColumnsPerTableFailThreshold()
    {
<span class="nc" id="L539">        return DEFAULT_CONFIG.getColumnsPerTableFailThreshold();</span>
    }

    @Override
    public void setColumnsPerTableThreshold(int warn, int fail)
    {
<span class="nc" id="L545">        DEFAULT_CONFIG.setColumnsPerTableThreshold(warn, fail);</span>
<span class="nc" id="L546">    }</span>

    @Override
    public int getSecondaryIndexesPerTableWarnThreshold()
    {
<span class="nc" id="L551">        return DEFAULT_CONFIG.getSecondaryIndexesPerTableWarnThreshold();</span>
    }

    @Override
    public int getSecondaryIndexesPerTableFailThreshold()
    {
<span class="nc" id="L557">        return DEFAULT_CONFIG.getSecondaryIndexesPerTableFailThreshold();</span>
    }

    @Override
    public void setSecondaryIndexesPerTableThreshold(int warn, int fail)
    {
<span class="nc" id="L563">        DEFAULT_CONFIG.setSecondaryIndexesPerTableThreshold(warn, fail);</span>
<span class="nc" id="L564">    }</span>

    @Override
    public boolean getSecondaryIndexesEnabled()
    {
<span class="nc" id="L569">        return DEFAULT_CONFIG.getSecondaryIndexesEnabled();</span>
    }

    @Override
    public void setSecondaryIndexesEnabled(boolean enabled)
    {
<span class="nc" id="L575">        DEFAULT_CONFIG.setSecondaryIndexesEnabled(enabled);</span>
<span class="nc" id="L576">    }</span>

    @Override
    public int getMaterializedViewsPerTableWarnThreshold()
    {
<span class="nc" id="L581">        return DEFAULT_CONFIG.getMaterializedViewsPerTableWarnThreshold();</span>
    }

    @Override
    public int getMaterializedViewsPerTableFailThreshold()
    {
<span class="nc" id="L587">        return DEFAULT_CONFIG.getMaterializedViewsPerTableFailThreshold();</span>
    }

    @Override
    public void setMaterializedViewsPerTableThreshold(int warn, int fail)
    {
<span class="nc" id="L593">        DEFAULT_CONFIG.setMaterializedViewsPerTableThreshold(warn, fail);</span>
<span class="nc" id="L594">    }</span>

    @Override
    public Set&lt;String&gt; getTablePropertiesWarned()
    {
<span class="nc" id="L599">        return DEFAULT_CONFIG.getTablePropertiesWarned();</span>
    }

    @Override
    public String getTablePropertiesWarnedCSV()
    {
<span class="nc" id="L605">        return toCSV(DEFAULT_CONFIG.getTablePropertiesWarned());</span>
    }

    public void setTablePropertiesWarned(String... properties)
    {
<span class="nc" id="L610">        setTablePropertiesWarned(ImmutableSet.copyOf(properties));</span>
<span class="nc" id="L611">    }</span>

    @Override
    public void setTablePropertiesWarned(Set&lt;String&gt; properties)
    {
<span class="nc" id="L616">        DEFAULT_CONFIG.setTablePropertiesWarned(properties);</span>
<span class="nc" id="L617">    }</span>

    @Override
    public void setTablePropertiesWarnedCSV(String properties)
    {
<span class="nc" id="L622">        setTablePropertiesWarned(fromCSV(properties));</span>
<span class="nc" id="L623">    }</span>

    @Override
    public Set&lt;String&gt; getTablePropertiesDisallowed()
    {
<span class="nc" id="L628">        return DEFAULT_CONFIG.getTablePropertiesDisallowed();</span>
    }

    @Override
    public String getTablePropertiesDisallowedCSV()
    {
<span class="nc" id="L634">        return toCSV(DEFAULT_CONFIG.getTablePropertiesDisallowed());</span>
    }

    public void setTablePropertiesDisallowed(String... properties)
    {
<span class="nc" id="L639">        setTablePropertiesDisallowed(ImmutableSet.copyOf(properties));</span>
<span class="nc" id="L640">    }</span>

    @Override
    public void setTablePropertiesDisallowed(Set&lt;String&gt; properties)
    {
<span class="nc" id="L645">        DEFAULT_CONFIG.setTablePropertiesDisallowed(properties);</span>
<span class="nc" id="L646">    }</span>

    @Override
    public void setTablePropertiesDisallowedCSV(String properties)
    {
<span class="nc" id="L651">        setTablePropertiesDisallowed(fromCSV(properties));</span>
<span class="nc" id="L652">    }</span>

    @Override
    public Set&lt;String&gt; getTablePropertiesIgnored()
    {
<span class="nc" id="L657">        return DEFAULT_CONFIG.getTablePropertiesIgnored();</span>
    }

    @Override
    public String getTablePropertiesIgnoredCSV()
    {
<span class="nc" id="L663">        return toCSV(DEFAULT_CONFIG.getTablePropertiesIgnored());</span>
    }

    public void setTablePropertiesIgnored(String... properties)
    {
<span class="nc" id="L668">        setTablePropertiesIgnored(ImmutableSet.copyOf(properties));</span>
<span class="nc" id="L669">    }</span>

    @Override
    public void setTablePropertiesIgnored(Set&lt;String&gt; properties)
    {
<span class="nc" id="L674">        DEFAULT_CONFIG.setTablePropertiesIgnored(properties);</span>
<span class="nc" id="L675">    }</span>

    @Override
    public void setTablePropertiesIgnoredCSV(String properties)
    {
<span class="nc" id="L680">        setTablePropertiesIgnored(fromCSV(properties));</span>
<span class="nc" id="L681">    }</span>

    @Override
    public boolean getUserTimestampsEnabled()
    {
<span class="nc" id="L686">        return DEFAULT_CONFIG.getUserTimestampsEnabled();</span>
    }

    @Override
    public void setUserTimestampsEnabled(boolean enabled)
    {
<span class="nc" id="L692">        DEFAULT_CONFIG.setUserTimestampsEnabled(enabled);</span>
<span class="nc" id="L693">    }</span>

    @Override
    public boolean getAlterTableEnabled()
    {
<span class="nc" id="L698">        return DEFAULT_CONFIG.getAlterTableEnabled();</span>
    }

    @Override
    public void setAlterTableEnabled(boolean enabled)
    {
<span class="nc" id="L704">        DEFAULT_CONFIG.setAlterTableEnabled(enabled);</span>
<span class="nc" id="L705">    }</span>

    @Override
    public boolean getAllowFilteringEnabled()
    {
<span class="nc" id="L710">        return DEFAULT_CONFIG.getAllowFilteringEnabled();</span>
    }

    @Override
    public void setAllowFilteringEnabled(boolean enabled)
    {
<span class="nc" id="L716">        DEFAULT_CONFIG.setAllowFilteringEnabled(enabled);</span>
<span class="nc" id="L717">    }</span>

    @Override
    public boolean getSimpleStrategyEnabled()
    {
<span class="nc" id="L722">        return DEFAULT_CONFIG.getSimpleStrategyEnabled();</span>
    }

    @Override
    public void setSimpleStrategyEnabled(boolean enabled)
    {
<span class="nc" id="L728">        DEFAULT_CONFIG.setSimpleStrategyEnabled(enabled);</span>
<span class="nc" id="L729">    }</span>

    @Override
    public boolean getUncompressedTablesEnabled()
    {
<span class="nc" id="L734">        return DEFAULT_CONFIG.getUncompressedTablesEnabled();</span>
    }

    @Override
    public void setUncompressedTablesEnabled(boolean enabled)
    {
<span class="nc" id="L740">        DEFAULT_CONFIG.setUncompressedTablesEnabled(enabled);</span>
<span class="nc" id="L741">    }</span>

    @Override
    public boolean getCompactTablesEnabled()
    {
<span class="nc" id="L746">        return DEFAULT_CONFIG.getCompactTablesEnabled();</span>
    }

    @Override
    public void setCompactTablesEnabled(boolean enabled)
    {
<span class="nc" id="L752">        DEFAULT_CONFIG.setCompactTablesEnabled(enabled);</span>
<span class="nc" id="L753">    }</span>

    @Override
    public boolean getGroupByEnabled()
    {
<span class="nc" id="L758">        return DEFAULT_CONFIG.getGroupByEnabled();</span>
    }

    @Override
    public void setGroupByEnabled(boolean enabled)
    {
<span class="nc" id="L764">        DEFAULT_CONFIG.setGroupByEnabled(enabled);</span>
<span class="nc" id="L765">    }</span>

    @Override
    public boolean getDropTruncateTableEnabled()
    {
<span class="nc" id="L770">        return DEFAULT_CONFIG.getDropTruncateTableEnabled();</span>
    }

    @Override
    public void setDropTruncateTableEnabled(boolean enabled)
    {
<span class="nc" id="L776">        DEFAULT_CONFIG.setDropTruncateTableEnabled(enabled);</span>
<span class="nc" id="L777">    }</span>

    @Override
    public boolean getDropKeyspaceEnabled()
    {
<span class="nc" id="L782">        return DEFAULT_CONFIG.getDropKeyspaceEnabled();</span>
    }

    @Override
    public void setDropKeyspaceEnabled(boolean enabled)
    {
<span class="nc" id="L788">        DEFAULT_CONFIG.setDropKeyspaceEnabled(enabled);</span>
<span class="nc" id="L789">    }</span>

    @Override
    public boolean getBulkLoadEnabled()
    {
<span class="nc" id="L794">        return DEFAULT_CONFIG.getBulkLoadEnabled();</span>
    }

    @Override
    public void setBulkLoadEnabled(boolean enabled)
    {
<span class="nc" id="L800">        DEFAULT_CONFIG.setBulkLoadEnabled(enabled);</span>
<span class="nc" id="L801">    }</span>

    @Override
    public int getPageSizeWarnThreshold()
    {
<span class="nc" id="L806">        return DEFAULT_CONFIG.getPageSizeWarnThreshold();</span>
    }

    @Override
    public int getPageSizeFailThreshold()
    {
<span class="nc" id="L812">        return DEFAULT_CONFIG.getPageSizeFailThreshold();</span>
    }

    @Override
    public void setPageSizeThreshold(int warn, int fail)
    {
<span class="nc" id="L818">        DEFAULT_CONFIG.setPageSizeThreshold(warn, fail);</span>
<span class="nc" id="L819">    }</span>

    @Override
    public boolean getReadBeforeWriteListOperationsEnabled()
    {
<span class="nc" id="L824">        return DEFAULT_CONFIG.getReadBeforeWriteListOperationsEnabled();</span>
    }

    @Override
    public void setReadBeforeWriteListOperationsEnabled(boolean enabled)
    {
<span class="nc" id="L830">        DEFAULT_CONFIG.setReadBeforeWriteListOperationsEnabled(enabled);</span>
<span class="nc" id="L831">    }</span>

    @Override
    public int getPartitionKeysInSelectWarnThreshold()
    {
<span class="nc" id="L836">        return DEFAULT_CONFIG.getPartitionKeysInSelectWarnThreshold();</span>
    }

    @Override
    public int getPartitionKeysInSelectFailThreshold()
    {
<span class="nc" id="L842">        return DEFAULT_CONFIG.getPartitionKeysInSelectFailThreshold();</span>
    }

    @Override
    public void setPartitionKeysInSelectThreshold(int warn, int fail)
    {
<span class="nc" id="L848">        DEFAULT_CONFIG.setPartitionKeysInSelectThreshold(warn, fail);</span>
<span class="nc" id="L849">    }</span>

    @Override
    @Nullable
    public String getPartitionSizeWarnThreshold()
    {
<span class="nc" id="L855">        return sizeToString(DEFAULT_CONFIG.getPartitionSizeWarnThreshold());</span>
    }

    @Override
    @Nullable
    public String getPartitionSizeFailThreshold()
    {
<span class="nc" id="L862">        return sizeToString(DEFAULT_CONFIG.getPartitionSizeFailThreshold());</span>
    }

    @Override
    public void setPartitionSizeThreshold(@Nullable String warnSize, @Nullable String failSize)
    {
<span class="nc" id="L868">        DEFAULT_CONFIG.setPartitionSizeThreshold(sizeFromString(warnSize), sizeFromString(failSize));</span>
<span class="nc" id="L869">    }</span>

    @Override
    public long getPartitionTombstonesWarnThreshold()
    {
<span class="nc" id="L874">        return DEFAULT_CONFIG.getPartitionTombstonesWarnThreshold();</span>
    }

    @Override
    public long getPartitionTombstonesFailThreshold()
    {
<span class="nc" id="L880">        return DEFAULT_CONFIG.getPartitionTombstonesFailThreshold();</span>
    }

    @Override
    public void setPartitionTombstonesThreshold(long warn, long fail)
    {
<span class="nc" id="L886">        DEFAULT_CONFIG.setPartitionTombstonesThreshold(warn, fail);</span>
<span class="nc" id="L887">    }</span>

    @Override
    @Nullable
    public String getColumnValueSizeWarnThreshold()
    {
<span class="nc" id="L893">        return sizeToString(DEFAULT_CONFIG.getColumnValueSizeWarnThreshold());</span>
    }

    @Override
    @Nullable
    public String getColumnValueSizeFailThreshold()
    {
<span class="nc" id="L900">        return sizeToString(DEFAULT_CONFIG.getColumnValueSizeFailThreshold());</span>
    }

    @Override
    public void setColumnValueSizeThreshold(@Nullable String warnSize, @Nullable String failSize)
    {
<span class="nc" id="L906">        DEFAULT_CONFIG.setColumnValueSizeThreshold(sizeFromString(warnSize), sizeFromString(failSize));</span>
<span class="nc" id="L907">    }</span>

    @Override
    @Nullable
    public String getCollectionSizeWarnThreshold()
    {
<span class="nc" id="L913">        return sizeToString(DEFAULT_CONFIG.getCollectionSizeWarnThreshold());</span>
    }

    @Override
    @Nullable
    public String getCollectionSizeFailThreshold()
    {
<span class="nc" id="L920">        return sizeToString(DEFAULT_CONFIG.getCollectionSizeFailThreshold());</span>
    }

    @Override
    public void setCollectionSizeThreshold(@Nullable String warnSize, @Nullable String failSize)
    {
<span class="nc" id="L926">        DEFAULT_CONFIG.setCollectionSizeThreshold(sizeFromString(warnSize), sizeFromString(failSize));</span>
<span class="nc" id="L927">    }</span>

    @Override
    public int getItemsPerCollectionWarnThreshold()
    {
<span class="nc" id="L932">        return DEFAULT_CONFIG.getItemsPerCollectionWarnThreshold();</span>
    }

    @Override
    public int getItemsPerCollectionFailThreshold()
    {
<span class="nc" id="L938">        return DEFAULT_CONFIG.getItemsPerCollectionFailThreshold();</span>
    }

    @Override
    public void setItemsPerCollectionThreshold(int warn, int fail)
    {
<span class="nc" id="L944">        DEFAULT_CONFIG.setItemsPerCollectionThreshold(warn, fail);</span>
<span class="nc" id="L945">    }</span>

    @Override
    public int getInSelectCartesianProductWarnThreshold()
    {
<span class="nc" id="L950">        return DEFAULT_CONFIG.getInSelectCartesianProductWarnThreshold();</span>
    }

    @Override
    public int getInSelectCartesianProductFailThreshold()
    {
<span class="nc" id="L956">        return DEFAULT_CONFIG.getInSelectCartesianProductFailThreshold();</span>
    }

    @Override
    public void setInSelectCartesianProductThreshold(int warn, int fail)
    {
<span class="nc" id="L962">        DEFAULT_CONFIG.setInSelectCartesianProductThreshold(warn, fail);</span>
<span class="nc" id="L963">    }</span>

    @Override
    public Set&lt;String&gt; getReadConsistencyLevelsWarned()
    {
<span class="nc" id="L968">        return toJmx(DEFAULT_CONFIG.getReadConsistencyLevelsWarned());</span>
    }

    @Override
    public String getReadConsistencyLevelsWarnedCSV()
    {
<span class="nc" id="L974">        return toCSV(DEFAULT_CONFIG.getReadConsistencyLevelsWarned(), ConsistencyLevel::toString);</span>
    }

    @Override
    public void setReadConsistencyLevelsWarned(Set&lt;String&gt; consistencyLevels)
    {
<span class="nc" id="L980">        DEFAULT_CONFIG.setReadConsistencyLevelsWarned(fromJmx(consistencyLevels));</span>
<span class="nc" id="L981">    }</span>

    @Override
    public void setReadConsistencyLevelsWarnedCSV(String consistencyLevels)
    {
<span class="nc" id="L986">        DEFAULT_CONFIG.setReadConsistencyLevelsWarned(fromCSV(consistencyLevels, ConsistencyLevel::fromString));</span>
<span class="nc" id="L987">    }</span>

    @Override
    public Set&lt;String&gt; getReadConsistencyLevelsDisallowed()
    {
<span class="nc" id="L992">        return toJmx(DEFAULT_CONFIG.getReadConsistencyLevelsDisallowed());</span>
    }

    @Override
    public String getReadConsistencyLevelsDisallowedCSV()
    {
<span class="nc" id="L998">        return toCSV(DEFAULT_CONFIG.getReadConsistencyLevelsDisallowed(), ConsistencyLevel::toString);</span>
    }

    @Override
    public void setReadConsistencyLevelsDisallowed(Set&lt;String&gt; consistencyLevels)
    {
<span class="nc" id="L1004">        DEFAULT_CONFIG.setReadConsistencyLevelsDisallowed(fromJmx(consistencyLevels));</span>
<span class="nc" id="L1005">    }</span>

    @Override
    public void setReadConsistencyLevelsDisallowedCSV(String consistencyLevels)
    {
<span class="nc" id="L1010">        DEFAULT_CONFIG.setReadConsistencyLevelsDisallowed(fromCSV(consistencyLevels, ConsistencyLevel::fromString));</span>
<span class="nc" id="L1011">    }</span>

    @Override
    public Set&lt;String&gt; getWriteConsistencyLevelsWarned()
    {
<span class="nc" id="L1016">        return toJmx(DEFAULT_CONFIG.getWriteConsistencyLevelsWarned());</span>
    }

    @Override
    public String getWriteConsistencyLevelsWarnedCSV()
    {
<span class="nc" id="L1022">        return toCSV(DEFAULT_CONFIG.getWriteConsistencyLevelsWarned(), ConsistencyLevel::toString);</span>
    }

    @Override
    public void setWriteConsistencyLevelsWarned(Set&lt;String&gt; consistencyLevels)
    {
<span class="nc" id="L1028">        DEFAULT_CONFIG.setWriteConsistencyLevelsWarned(fromJmx(consistencyLevels));</span>
<span class="nc" id="L1029">    }</span>

    @Override
    public void setWriteConsistencyLevelsWarnedCSV(String consistencyLevels)
    {
<span class="nc" id="L1034">        DEFAULT_CONFIG.setWriteConsistencyLevelsWarned(fromCSV(consistencyLevels, ConsistencyLevel::fromString));</span>
<span class="nc" id="L1035">    }</span>

    @Override
    public Set&lt;String&gt; getWriteConsistencyLevelsDisallowed()
    {
<span class="nc" id="L1040">        return toJmx(DEFAULT_CONFIG.getWriteConsistencyLevelsDisallowed());</span>
    }

    @Override
    public String getWriteConsistencyLevelsDisallowedCSV()
    {
<span class="nc" id="L1046">        return toCSV(DEFAULT_CONFIG.getWriteConsistencyLevelsDisallowed(), ConsistencyLevel::toString);</span>
    }

    @Override
    public void setWriteConsistencyLevelsDisallowed(Set&lt;String&gt; consistencyLevels)
    {
<span class="nc" id="L1052">        DEFAULT_CONFIG.setWriteConsistencyLevelsDisallowed(fromJmx(consistencyLevels));</span>
<span class="nc" id="L1053">    }</span>

    @Override
    public void setWriteConsistencyLevelsDisallowedCSV(String consistencyLevels)
    {
<span class="nc" id="L1058">        DEFAULT_CONFIG.setWriteConsistencyLevelsDisallowed(fromCSV(consistencyLevels, ConsistencyLevel::fromString));</span>
<span class="nc" id="L1059">    }</span>

    @Override
    public int getFieldsPerUDTWarnThreshold()
    {
<span class="nc" id="L1064">        return DEFAULT_CONFIG.getFieldsPerUDTWarnThreshold();</span>
    }

    @Override
    public int getFieldsPerUDTFailThreshold()
    {
<span class="nc" id="L1070">        return DEFAULT_CONFIG.getFieldsPerUDTFailThreshold();</span>
    }

    @Override
    public void setFieldsPerUDTThreshold(int warn, int fail)
    {
<span class="nc" id="L1076">        DEFAULT_CONFIG.setFieldsPerUDTThreshold(warn, fail);</span>
<span class="nc" id="L1077">    }</span>

    @Override
    public int getVectorDimensionsWarnThreshold()
    {
<span class="nc" id="L1082">        return DEFAULT_CONFIG.getVectorDimensionsWarnThreshold();</span>
    }

    @Override
    public int getVectorDimensionsFailThreshold()
    {
<span class="nc" id="L1088">        return DEFAULT_CONFIG.getVectorDimensionsFailThreshold();</span>
    }

    @Override
    public void setVectorDimensionsThreshold(int warn, int fail)
    {
<span class="nc" id="L1094">        DEFAULT_CONFIG.setVectorDimensionsThreshold(warn, fail);</span>
<span class="nc" id="L1095">    }</span>

    @Override
    public int getMaximumReplicationFactorWarnThreshold()
    {
<span class="nc" id="L1100">        return DEFAULT_CONFIG.getMaximumReplicationFactorWarnThreshold();</span>
    }

    @Override
    public int getMaximumReplicationFactorFailThreshold()
    {
<span class="nc" id="L1106">        return DEFAULT_CONFIG.getMaximumReplicationFactorFailThreshold();</span>
    }

    @Override
    public void setMaximumReplicationFactorThreshold (int warn, int fail)
    {
<span class="nc" id="L1112">        DEFAULT_CONFIG.setMaximumReplicationFactorThreshold(warn, fail);</span>
<span class="nc" id="L1113">    }</span>

    @Override
    public int getDataDiskUsagePercentageWarnThreshold()
    {
<span class="nc" id="L1118">        return DEFAULT_CONFIG.getDataDiskUsagePercentageWarnThreshold();</span>
    }

    @Override
    public int getDataDiskUsagePercentageFailThreshold()
    {
<span class="nc" id="L1124">        return DEFAULT_CONFIG.getDataDiskUsagePercentageFailThreshold();</span>
    }

    @Override
    public void setDataDiskUsagePercentageThreshold(int warn, int fail)
    {
<span class="nc" id="L1130">        DEFAULT_CONFIG.setDataDiskUsagePercentageThreshold(warn, fail);</span>
<span class="nc" id="L1131">    }</span>

    @Override
    @Nullable
    public String getDataDiskUsageMaxDiskSize()
    {
<span class="nc" id="L1137">        return sizeToString(DEFAULT_CONFIG.getDataDiskUsageMaxDiskSize());</span>
    }

    @Override
    public void setDataDiskUsageMaxDiskSize(@Nullable String size)
    {
<span class="nc" id="L1143">        DEFAULT_CONFIG.setDataDiskUsageMaxDiskSize(sizeFromString(size));</span>
<span class="nc" id="L1144">    }</span>

    @Override
    public int getMinimumReplicationFactorWarnThreshold()
    {
<span class="nc" id="L1149">        return DEFAULT_CONFIG.getMinimumReplicationFactorWarnThreshold();</span>
    }

    @Override
    public int getMinimumReplicationFactorFailThreshold()
    {
<span class="nc" id="L1155">        return DEFAULT_CONFIG.getMinimumReplicationFactorFailThreshold();</span>
    }

    @Override
    public void setMinimumReplicationFactorThreshold(int warn, int fail)
    {
<span class="nc" id="L1161">        DEFAULT_CONFIG.setMinimumReplicationFactorThreshold(warn, fail);</span>
<span class="nc" id="L1162">    }</span>

    @Override
    public boolean getZeroTTLOnTWCSEnabled()
    {
<span class="nc" id="L1167">        return DEFAULT_CONFIG.getZeroTTLOnTWCSEnabled();</span>
    }

    @Override
    public void setZeroTTLOnTWCSEnabled(boolean value)
    {
<span class="nc" id="L1173">        DEFAULT_CONFIG.setZeroTTLOnTWCSEnabled(value);</span>
<span class="nc" id="L1174">    }</span>

    @Override
    public boolean getZeroTTLOnTWCSWarned()
    {
<span class="nc" id="L1179">        return DEFAULT_CONFIG.getZeroTTLOnTWCSWarned();</span>
    }

    @Override
    public void setZeroTTLOnTWCSWarned(boolean value)
    {
<span class="nc" id="L1185">        DEFAULT_CONFIG.setZeroTTLOnTWCSWarned(value);</span>
<span class="nc" id="L1186">    }</span>

    @Override
    public String getMaximumTimestampWarnThreshold()
    {
<span class="nc" id="L1191">        return durationToString(DEFAULT_CONFIG.getMaximumTimestampWarnThreshold());</span>
    }

    @Override
    public String getMaximumTimestampFailThreshold()
    {
<span class="nc" id="L1197">        return durationToString(DEFAULT_CONFIG.getMaximumTimestampFailThreshold());</span>
    }

    @Override
    public void setMaximumTimestampThreshold(String warnSeconds, String failSeconds)
    {
<span class="nc" id="L1203">        DEFAULT_CONFIG.setMaximumTimestampThreshold(durationFromString(warnSeconds), durationFromString(failSeconds));</span>
<span class="nc" id="L1204">    }</span>

    @Override
    public String getMinimumTimestampWarnThreshold()
    {
<span class="nc" id="L1209">        return durationToString(DEFAULT_CONFIG.getMinimumTimestampWarnThreshold());</span>
    }

    @Override
    public String getMinimumTimestampFailThreshold()
    {
<span class="nc" id="L1215">        return durationToString(DEFAULT_CONFIG.getMinimumTimestampFailThreshold());</span>
    }

    @Override
    public void setMinimumTimestampThreshold(String warnSeconds, String failSeconds)
    {
<span class="nc" id="L1221">        DEFAULT_CONFIG.setMinimumTimestampThreshold(durationFromString(warnSeconds), durationFromString(failSeconds));</span>
<span class="nc" id="L1222">    }</span>

    private static String toCSV(Set&lt;String&gt; values)
    {
<span class="nc bnc" id="L1226" title="All 4 branches missed.">        return values == null || values.isEmpty() ? &quot;&quot; : String.join(&quot;,&quot;, values);</span>
    }

    private static &lt;T&gt; String toCSV(Set&lt;T&gt; values, Function&lt;T, String&gt; formatter)
    {
<span class="nc bnc" id="L1231" title="All 4 branches missed.">        return values == null || values.isEmpty() ? &quot;&quot; : values.stream().map(formatter).collect(Collectors.joining(&quot;,&quot;));</span>
    }

    private static Set&lt;String&gt; fromCSV(String csv)
    {
<span class="nc bnc" id="L1236" title="All 2 branches missed.">        return StringUtils.isEmpty(csv) ? Collections.emptySet() : ImmutableSet.copyOf(csv.split(&quot;,&quot;));</span>
    }

    private static &lt;T&gt; Set&lt;T&gt; fromCSV(String csv, Function&lt;String, T&gt; parser)
    {
<span class="nc bnc" id="L1241" title="All 2 branches missed.">        return StringUtils.isEmpty(csv) ? Collections.emptySet() : fromCSV(csv).stream().map(parser).collect(Collectors.toSet());</span>
    }

    private static Set&lt;String&gt; toJmx(Set&lt;ConsistencyLevel&gt; set)
    {
<span class="nc bnc" id="L1246" title="All 2 branches missed.">        if (set == null)</span>
<span class="nc" id="L1247">            return null;</span>
<span class="nc" id="L1248">        return set.stream().map(ConsistencyLevel::name).collect(Collectors.toSet());</span>
    }

    private static Set&lt;ConsistencyLevel&gt; fromJmx(Set&lt;String&gt; set)
    {
<span class="nc bnc" id="L1253" title="All 2 branches missed.">        if (set == null)</span>
<span class="nc" id="L1254">            return null;</span>
<span class="nc" id="L1255">        return set.stream().map(ConsistencyLevel::valueOf).collect(Collectors.toSet());</span>
    }

    private static Long sizeToBytes(@Nullable DataStorageSpec.LongBytesBound size)
    {
<span class="pc bpc" id="L1260" title="1 of 2 branches missed.">        return size == null ? -1 : size.toBytes();</span>
    }

    private static String sizeToString(@Nullable DataStorageSpec size)
    {
<span class="nc bnc" id="L1265" title="All 2 branches missed.">        return size == null ? null : size.toString();</span>
    }

    private static DataStorageSpec.LongBytesBound sizeFromString(@Nullable String size)
    {
<span class="nc bnc" id="L1270" title="All 2 branches missed.">        return StringUtils.isEmpty(size) ? null : new DataStorageSpec.LongBytesBound(size);</span>
    }

    private static String durationToString(@Nullable DurationSpec duration)
    {
<span class="nc bnc" id="L1275" title="All 2 branches missed.">        return duration == null ? null : duration.toString();</span>
    }

    private static DurationSpec.LongMicrosecondsBound durationFromString(@Nullable String duration)
    {
<span class="nc bnc" id="L1280" title="All 2 branches missed.">        return StringUtils.isEmpty(duration) ? null : new DurationSpec.LongMicrosecondsBound(duration);</span>
    }

    private static long maximumTimestampAsRelativeMicros(@Nullable DurationSpec.LongMicrosecondsBound duration)
    {
<span class="nc bnc" id="L1285" title="All 2 branches missed.">        return duration == null</span>
<span class="nc" id="L1286">               ? Long.MAX_VALUE</span>
<span class="nc" id="L1287">               : (ClientState.getLastTimestampMicros() + duration.toMicroseconds());</span>
    }

    private static long minimumTimestampAsRelativeMicros(@Nullable DurationSpec.LongMicrosecondsBound duration)
    {
<span class="nc bnc" id="L1292" title="All 2 branches missed.">        return duration == null</span>
<span class="nc" id="L1293">               ? Long.MIN_VALUE</span>
<span class="nc" id="L1294">               : (ClientState.getLastTimestampMicros() - duration.toMicroseconds());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>
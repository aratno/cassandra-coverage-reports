<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GuardrailsOptions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Cassandara Coverage Report</a> &gt; <a href="index.source.html" class="el_package">org.apache.cassandra.config</a> &gt; <span class="el_source">GuardrailsOptions.java</span></div><h1>GuardrailsOptions.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.cassandra.config;

import java.util.Collections;
import java.util.Set;
import java.util.function.Consumer;
import java.util.function.Supplier;
import javax.annotation.Nullable;

import com.google.common.collect.Sets;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import org.apache.cassandra.cql3.statements.schema.TableAttributes;
import org.apache.cassandra.db.ConsistencyLevel;
import org.apache.cassandra.db.guardrails.Guardrails;
import org.apache.cassandra.db.guardrails.GuardrailsConfig;
import org.apache.cassandra.io.util.FileUtils;
import org.apache.cassandra.service.disk.usage.DiskUsageMonitor;

import static java.lang.String.format;
import static java.util.stream.Collectors.toSet;

/**
 * Configuration settings for guardrails populated from the Yaml file.
 *
 * &lt;p&gt;Note that the settings here must only be used to build the {@link GuardrailsConfig} class and not directly by the
 * code checking each guarded constraint. That code should use the higher level abstractions defined in
 * {@link Guardrails}).
 *
 * &lt;p&gt;We have 2 variants of guardrails, soft (warn) and hard (fail) limits, each guardrail having either one of the
 * variants or both. Note in particular that hard limits only make sense for guardrails triggering during query
 * execution. For other guardrails, say one triggering during compaction, aborting that compaction does not make sense.
 *
 * &lt;p&gt;Additionally, each individual setting should have a specific value (typically -1 for numeric settings),
 * that allows to disable the corresponding guardrail.
 */
public class GuardrailsOptions implements GuardrailsConfig
{
<span class="fc" id="L57">    private static final Logger logger = LoggerFactory.getLogger(GuardrailsOptions.class);</span>

    private final Config config;

    public GuardrailsOptions(Config config)
<span class="fc" id="L62">    {</span>
<span class="fc" id="L63">        this.config = config;</span>
<span class="fc" id="L64">        validateMaxIntThreshold(config.keyspaces_warn_threshold, config.keyspaces_fail_threshold, &quot;keyspaces&quot;);</span>
<span class="fc" id="L65">        validateMaxIntThreshold(config.tables_warn_threshold, config.tables_fail_threshold, &quot;tables&quot;);</span>
<span class="fc" id="L66">        validateMaxIntThreshold(config.columns_per_table_warn_threshold, config.columns_per_table_fail_threshold, &quot;columns_per_table&quot;);</span>
<span class="fc" id="L67">        validateMaxIntThreshold(config.secondary_indexes_per_table_warn_threshold, config.secondary_indexes_per_table_fail_threshold, &quot;secondary_indexes_per_table&quot;);</span>
<span class="fc" id="L68">        validateMaxIntThreshold(config.materialized_views_per_table_warn_threshold, config.materialized_views_per_table_fail_threshold, &quot;materialized_views_per_table&quot;);</span>
<span class="fc" id="L69">        config.table_properties_warned = validateTableProperties(config.table_properties_warned, &quot;table_properties_warned&quot;);</span>
<span class="fc" id="L70">        config.table_properties_ignored = validateTableProperties(config.table_properties_ignored, &quot;table_properties_ignored&quot;);</span>
<span class="fc" id="L71">        config.table_properties_disallowed = validateTableProperties(config.table_properties_disallowed, &quot;table_properties_disallowed&quot;);</span>
<span class="fc" id="L72">        validateMaxIntThreshold(config.page_size_warn_threshold, config.page_size_fail_threshold, &quot;page_size&quot;);</span>
<span class="fc" id="L73">        validateMaxIntThreshold(config.partition_keys_in_select_warn_threshold, config.partition_keys_in_select_fail_threshold, &quot;partition_keys_in_select&quot;);</span>
<span class="fc" id="L74">        validateMaxIntThreshold(config.in_select_cartesian_product_warn_threshold, config.in_select_cartesian_product_fail_threshold, &quot;in_select_cartesian_product&quot;);</span>
<span class="fc" id="L75">        config.read_consistency_levels_warned = validateConsistencyLevels(config.read_consistency_levels_warned, &quot;read_consistency_levels_warned&quot;);</span>
<span class="fc" id="L76">        config.read_consistency_levels_disallowed = validateConsistencyLevels(config.read_consistency_levels_disallowed, &quot;read_consistency_levels_disallowed&quot;);</span>
<span class="fc" id="L77">        config.write_consistency_levels_warned = validateConsistencyLevels(config.write_consistency_levels_warned, &quot;write_consistency_levels_warned&quot;);</span>
<span class="fc" id="L78">        config.write_consistency_levels_disallowed = validateConsistencyLevels(config.write_consistency_levels_disallowed, &quot;write_consistency_levels_disallowed&quot;);</span>
<span class="fc" id="L79">        validateSizeThreshold(config.partition_size_warn_threshold, config.partition_size_fail_threshold, false, &quot;partition_size&quot;);</span>
<span class="fc" id="L80">        validateMaxLongThreshold(config.partition_tombstones_warn_threshold, config.partition_tombstones_fail_threshold, &quot;partition_tombstones&quot;, false);</span>
<span class="fc" id="L81">        validateSizeThreshold(config.column_value_size_warn_threshold, config.column_value_size_fail_threshold, false, &quot;column_value_size&quot;);</span>
<span class="fc" id="L82">        validateSizeThreshold(config.collection_size_warn_threshold, config.collection_size_fail_threshold, false, &quot;collection_size&quot;);</span>
<span class="fc" id="L83">        validateMaxIntThreshold(config.items_per_collection_warn_threshold, config.items_per_collection_fail_threshold, &quot;items_per_collection&quot;);</span>
<span class="fc" id="L84">        validateMaxIntThreshold(config.fields_per_udt_warn_threshold, config.fields_per_udt_fail_threshold, &quot;fields_per_udt&quot;);</span>
<span class="fc" id="L85">        validateMaxIntThreshold(config.vector_dimensions_warn_threshold, config.vector_dimensions_fail_threshold, &quot;vector_dimensions&quot;);</span>
<span class="fc" id="L86">        validatePercentageThreshold(config.data_disk_usage_percentage_warn_threshold, config.data_disk_usage_percentage_fail_threshold, &quot;data_disk_usage_percentage&quot;);</span>
<span class="fc" id="L87">        validateDataDiskUsageMaxDiskSize(config.data_disk_usage_max_disk_size);</span>
<span class="fc" id="L88">        validateMinRFThreshold(config.minimum_replication_factor_warn_threshold, config.minimum_replication_factor_fail_threshold);</span>
<span class="fc" id="L89">        validateMaxRFThreshold(config.maximum_replication_factor_warn_threshold, config.maximum_replication_factor_fail_threshold);</span>
<span class="fc" id="L90">        validateTimestampThreshold(config.maximum_timestamp_warn_threshold, config.maximum_timestamp_fail_threshold, &quot;maximum_timestamp&quot;);</span>
<span class="fc" id="L91">        validateTimestampThreshold(config.minimum_timestamp_warn_threshold, config.minimum_timestamp_fail_threshold, &quot;minimum_timestamp&quot;);</span>
<span class="fc" id="L92">    }</span>

    @Override
    public int getKeyspacesWarnThreshold()
    {
<span class="fc" id="L97">        return config.keyspaces_warn_threshold;</span>
    }

    @Override
    public int getKeyspacesFailThreshold()
    {
<span class="fc" id="L103">        return config.keyspaces_fail_threshold;</span>
    }

    public void setKeyspacesThreshold(int warn, int fail)
    {
<span class="nc" id="L108">        validateMaxIntThreshold(warn, fail, &quot;keyspaces&quot;);</span>
<span class="nc" id="L109">        updatePropertyWithLogging(&quot;keyspaces_warn_threshold&quot;,</span>
<span class="nc" id="L110">                                  warn,</span>
<span class="nc" id="L111">                                  () -&gt; config.keyspaces_warn_threshold,</span>
<span class="nc" id="L112">                                  x -&gt; config.keyspaces_warn_threshold = x);</span>
<span class="nc" id="L113">        updatePropertyWithLogging(&quot;keyspaces_fail_threshold&quot;,</span>
<span class="nc" id="L114">                                  fail,</span>
<span class="nc" id="L115">                                  () -&gt; config.keyspaces_fail_threshold,</span>
<span class="nc" id="L116">                                  x -&gt; config.keyspaces_fail_threshold = x);</span>
<span class="nc" id="L117">    }</span>

    @Override
    public int getTablesWarnThreshold()
    {
<span class="fc" id="L122">        return config.tables_warn_threshold;</span>
    }

    @Override
    public int getTablesFailThreshold()
    {
<span class="fc" id="L128">        return config.tables_fail_threshold;</span>
    }

    public void setTablesThreshold(int warn, int fail)
    {
<span class="nc" id="L133">        validateMaxIntThreshold(warn, fail, &quot;tables&quot;);</span>
<span class="nc" id="L134">        updatePropertyWithLogging(&quot;tables_warn_threshold&quot;,</span>
<span class="nc" id="L135">                                  warn,</span>
<span class="nc" id="L136">                                  () -&gt; config.tables_warn_threshold,</span>
<span class="nc" id="L137">                                  x -&gt; config.tables_warn_threshold = x);</span>
<span class="nc" id="L138">        updatePropertyWithLogging(&quot;tables_fail_threshold&quot;,</span>
<span class="nc" id="L139">                                  fail,</span>
<span class="nc" id="L140">                                  () -&gt; config.tables_fail_threshold,</span>
<span class="nc" id="L141">                                  x -&gt; config.tables_fail_threshold = x);</span>
<span class="nc" id="L142">    }</span>

    @Override
    public int getColumnsPerTableWarnThreshold()
    {
<span class="fc" id="L147">        return config.columns_per_table_warn_threshold;</span>
    }

    @Override
    public int getColumnsPerTableFailThreshold()
    {
<span class="fc" id="L153">        return config.columns_per_table_fail_threshold;</span>
    }

    public void setColumnsPerTableThreshold(int warn, int fail)
    {
<span class="nc" id="L158">        validateMaxIntThreshold(warn, fail, &quot;columns_per_table&quot;);</span>
<span class="nc" id="L159">        updatePropertyWithLogging(&quot;columns_per_table_warn_threshold&quot;,</span>
<span class="nc" id="L160">                                  warn,</span>
<span class="nc" id="L161">                                  () -&gt; config.columns_per_table_warn_threshold,</span>
<span class="nc" id="L162">                                  x -&gt; config.columns_per_table_warn_threshold = x);</span>
<span class="nc" id="L163">        updatePropertyWithLogging(&quot;columns_per_table_fail_threshold&quot;,</span>
<span class="nc" id="L164">                                  fail,</span>
<span class="nc" id="L165">                                  () -&gt; config.columns_per_table_fail_threshold,</span>
<span class="nc" id="L166">                                  x -&gt; config.columns_per_table_fail_threshold = x);</span>
<span class="nc" id="L167">    }</span>

    @Override
    public int getSecondaryIndexesPerTableWarnThreshold()
    {
<span class="fc" id="L172">        return config.secondary_indexes_per_table_warn_threshold;</span>
    }

    @Override
    public int getSecondaryIndexesPerTableFailThreshold()
    {
<span class="fc" id="L178">        return config.secondary_indexes_per_table_fail_threshold;</span>
    }

    public void setSecondaryIndexesPerTableThreshold(int warn, int fail)
    {
<span class="nc" id="L183">        validateMaxIntThreshold(warn, fail, &quot;secondary_indexes_per_table&quot;);</span>
<span class="nc" id="L184">        updatePropertyWithLogging(&quot;secondary_indexes_per_table_warn_threshold&quot;,</span>
<span class="nc" id="L185">                                  warn,</span>
<span class="nc" id="L186">                                  () -&gt; config.secondary_indexes_per_table_warn_threshold,</span>
<span class="nc" id="L187">                                  x -&gt; config.secondary_indexes_per_table_warn_threshold = x);</span>
<span class="nc" id="L188">        updatePropertyWithLogging(&quot;secondary_indexes_per_table_fail_threshold&quot;,</span>
<span class="nc" id="L189">                                  fail,</span>
<span class="nc" id="L190">                                  () -&gt; config.secondary_indexes_per_table_fail_threshold,</span>
<span class="nc" id="L191">                                  x -&gt; config.secondary_indexes_per_table_fail_threshold = x);</span>
<span class="nc" id="L192">    }</span>

    @Override
    public int getMaterializedViewsPerTableWarnThreshold()
    {
<span class="fc" id="L197">        return config.materialized_views_per_table_warn_threshold;</span>
    }

    @Override
    public int getPartitionKeysInSelectWarnThreshold()
    {
<span class="fc" id="L203">        return config.partition_keys_in_select_warn_threshold;</span>
    }

    @Override
    public int getPartitionKeysInSelectFailThreshold()
    {
<span class="fc" id="L209">        return config.partition_keys_in_select_fail_threshold;</span>
    }

    public void setPartitionKeysInSelectThreshold(int warn, int fail)
    {
<span class="nc" id="L214">        validateMaxIntThreshold(warn, fail, &quot;partition_keys_in_select&quot;);</span>
<span class="nc" id="L215">        updatePropertyWithLogging(&quot;partition_keys_in_select_warn_threshold&quot;,</span>
<span class="nc" id="L216">                                  warn,</span>
<span class="nc" id="L217">                                  () -&gt; config.partition_keys_in_select_warn_threshold,</span>
<span class="nc" id="L218">                                  x -&gt; config.partition_keys_in_select_warn_threshold = x);</span>
<span class="nc" id="L219">        updatePropertyWithLogging(&quot;partition_keys_in_select_fail_threshold&quot;,</span>
<span class="nc" id="L220">                                  fail,</span>
<span class="nc" id="L221">                                  () -&gt; config.partition_keys_in_select_fail_threshold,</span>
<span class="nc" id="L222">                                  x -&gt; config.partition_keys_in_select_fail_threshold = x);</span>
<span class="nc" id="L223">    }</span>

    @Override
    public int getMaterializedViewsPerTableFailThreshold()
    {
<span class="fc" id="L228">        return config.materialized_views_per_table_fail_threshold;</span>
    }

    public void setMaterializedViewsPerTableThreshold(int warn, int fail)
    {
<span class="nc" id="L233">        validateMaxIntThreshold(warn, fail, &quot;materialized_views_per_table&quot;);</span>
<span class="nc" id="L234">        updatePropertyWithLogging(&quot;materialized_views_per_table_warn_threshold&quot;,</span>
<span class="nc" id="L235">                                  warn,</span>
<span class="nc" id="L236">                                  () -&gt; config.materialized_views_per_table_warn_threshold,</span>
<span class="nc" id="L237">                                  x -&gt; config.materialized_views_per_table_warn_threshold = x);</span>
<span class="nc" id="L238">        updatePropertyWithLogging(&quot;materialized_views_per_table_fail_threshold&quot;,</span>
<span class="nc" id="L239">                                  fail,</span>
<span class="nc" id="L240">                                  () -&gt; config.materialized_views_per_table_fail_threshold,</span>
<span class="nc" id="L241">                                  x -&gt; config.materialized_views_per_table_fail_threshold = x);</span>
<span class="nc" id="L242">    }</span>

    @Override
    public int getPageSizeWarnThreshold()
    {
<span class="fc" id="L247">        return config.page_size_warn_threshold;</span>
    }

    @Override
    public int getPageSizeFailThreshold()
    {
<span class="fc" id="L253">        return config.page_size_fail_threshold;</span>
    }

    public void setPageSizeThreshold(int warn, int fail)
    {
<span class="nc" id="L258">        validateMaxIntThreshold(warn, fail, &quot;page_size&quot;);</span>
<span class="nc" id="L259">        updatePropertyWithLogging(&quot;page_size_warn_threshold&quot;,</span>
<span class="nc" id="L260">                                  warn,</span>
<span class="nc" id="L261">                                  () -&gt; config.page_size_warn_threshold,</span>
<span class="nc" id="L262">                                  x -&gt; config.page_size_warn_threshold = x);</span>
<span class="nc" id="L263">        updatePropertyWithLogging(&quot;page_size_fail_threshold&quot;,</span>
<span class="nc" id="L264">                                  fail,</span>
<span class="nc" id="L265">                                  () -&gt; config.page_size_fail_threshold,</span>
<span class="nc" id="L266">                                  x -&gt; config.page_size_fail_threshold = x);</span>
<span class="nc" id="L267">    }</span>

    @Override
    public Set&lt;String&gt; getTablePropertiesWarned()
    {
<span class="fc" id="L272">        return config.table_properties_warned;</span>
    }

    public void setTablePropertiesWarned(Set&lt;String&gt; properties)
    {
<span class="nc" id="L277">        updatePropertyWithLogging(&quot;table_properties_warned&quot;,</span>
<span class="nc" id="L278">                                  validateTableProperties(properties, &quot;table_properties_warned&quot;),</span>
<span class="nc" id="L279">                                  () -&gt; config.table_properties_warned,</span>
<span class="nc" id="L280">                                  x -&gt; config.table_properties_warned = x);</span>
<span class="nc" id="L281">    }</span>

    @Override
    public Set&lt;String&gt; getTablePropertiesIgnored()
    {
<span class="fc" id="L286">        return config.table_properties_ignored;</span>
    }

    public void setTablePropertiesIgnored(Set&lt;String&gt; properties)
    {
<span class="nc" id="L291">        updatePropertyWithLogging(&quot;table_properties_ignored&quot;,</span>
<span class="nc" id="L292">                                  validateTableProperties(properties, &quot;table_properties_ignored&quot;),</span>
<span class="nc" id="L293">                                  () -&gt; config.table_properties_ignored,</span>
<span class="nc" id="L294">                                  x -&gt; config.table_properties_ignored = x);</span>
<span class="nc" id="L295">    }</span>

    @Override
    public Set&lt;String&gt; getTablePropertiesDisallowed()
    {
<span class="fc" id="L300">        return config.table_properties_disallowed;</span>
    }

    public void setTablePropertiesDisallowed(Set&lt;String&gt; properties)
    {
<span class="nc" id="L305">        updatePropertyWithLogging(&quot;table_properties_disallowed&quot;,</span>
<span class="nc" id="L306">                                  validateTableProperties(properties, &quot;table_properties_disallowed&quot;),</span>
<span class="nc" id="L307">                                  () -&gt; config.table_properties_disallowed,</span>
<span class="nc" id="L308">                                  x -&gt; config.table_properties_disallowed = x);</span>
<span class="nc" id="L309">    }</span>

    @Override
    public boolean getUserTimestampsEnabled()
    {
<span class="fc" id="L314">        return config.user_timestamps_enabled;</span>
    }

    public void setUserTimestampsEnabled(boolean enabled)
    {
<span class="nc" id="L319">        updatePropertyWithLogging(&quot;user_timestamps_enabled&quot;,</span>
<span class="nc" id="L320">                                  enabled,</span>
<span class="nc" id="L321">                                  () -&gt; config.user_timestamps_enabled,</span>
<span class="nc" id="L322">                                  x -&gt; config.user_timestamps_enabled = x);</span>
<span class="nc" id="L323">    }</span>

    @Override
    public boolean getGroupByEnabled()
    {
<span class="fc" id="L328">        return config.group_by_enabled;</span>
    }

    public void setGroupByEnabled(boolean enabled)
    {
<span class="nc" id="L333">        updatePropertyWithLogging(&quot;group_by_enabled&quot;,</span>
<span class="nc" id="L334">                                  enabled,</span>
<span class="nc" id="L335">                                  () -&gt; config.group_by_enabled,</span>
<span class="nc" id="L336">                                  x -&gt; config.group_by_enabled = x);</span>
<span class="nc" id="L337">    }</span>

    @Override
    public boolean getDropTruncateTableEnabled()
    {
<span class="fc" id="L342">        return config.drop_truncate_table_enabled;</span>
    }

    public void setDropTruncateTableEnabled(boolean enabled)
    {
<span class="nc" id="L347">        updatePropertyWithLogging(&quot;drop_truncate_table_enabled&quot;,</span>
<span class="nc" id="L348">                                  enabled,</span>
<span class="nc" id="L349">                                  () -&gt; config.drop_truncate_table_enabled,</span>
<span class="nc" id="L350">                                  x -&gt; config.drop_truncate_table_enabled = x);</span>
<span class="nc" id="L351">    }</span>

    @Override
    public boolean getDropKeyspaceEnabled()
    {
<span class="fc" id="L356">        return config.drop_keyspace_enabled;</span>
    }

    public void setDropKeyspaceEnabled(boolean enabled)
    {
<span class="nc" id="L361">        updatePropertyWithLogging(&quot;drop_keyspace_enabled&quot;,</span>
<span class="nc" id="L362">                                  enabled,</span>
<span class="nc" id="L363">                                  () -&gt; config.drop_keyspace_enabled,</span>
<span class="nc" id="L364">                                  x -&gt; config.drop_keyspace_enabled = x);</span>
<span class="nc" id="L365">    }</span>

    @Override
    public boolean getBulkLoadEnabled()
    {
<span class="fc" id="L370">        return config.bulk_load_enabled;</span>
    }

    public void setBulkLoadEnabled(boolean enabled)
    {
<span class="fc" id="L375">        updatePropertyWithLogging(&quot;bulk_load_enabled&quot;,</span>
<span class="fc" id="L376">                                  enabled,</span>
<span class="fc" id="L377">                                  () -&gt; config.bulk_load_enabled,</span>
<span class="fc" id="L378">                                  x -&gt; config.bulk_load_enabled = x);</span>
<span class="fc" id="L379">    }</span>

    @Override
    public boolean getSecondaryIndexesEnabled()
    {
<span class="fc" id="L384">        return config.secondary_indexes_enabled;</span>
    }

    public void setSecondaryIndexesEnabled(boolean enabled)
    {
<span class="nc" id="L389">        updatePropertyWithLogging(&quot;secondary_indexes_enabled&quot;,</span>
<span class="nc" id="L390">                                  enabled,</span>
<span class="nc" id="L391">                                  () -&gt; config.secondary_indexes_enabled,</span>
<span class="nc" id="L392">                                  x -&gt; config.secondary_indexes_enabled = x);</span>
<span class="nc" id="L393">    }</span>

    @Override
    public boolean getUncompressedTablesEnabled()
    {
<span class="fc" id="L398">        return config.uncompressed_tables_enabled;</span>
    }

    public void setUncompressedTablesEnabled(boolean enabled)
    {
<span class="nc" id="L403">        updatePropertyWithLogging(&quot;uncompressed_tables_enabled&quot;,</span>
<span class="nc" id="L404">                                  enabled,</span>
<span class="nc" id="L405">                                  () -&gt; config.uncompressed_tables_enabled,</span>
<span class="nc" id="L406">                                  x -&gt; config.uncompressed_tables_enabled = x);</span>
<span class="nc" id="L407">    }</span>

    @Override
    public boolean getCompactTablesEnabled()
    {
<span class="fc" id="L412">        return config.compact_tables_enabled;</span>
    }

    public void setCompactTablesEnabled(boolean enabled)
    {
<span class="nc" id="L417">        updatePropertyWithLogging(&quot;compact_tables_enabled&quot;,</span>
<span class="nc" id="L418">                                  enabled,</span>
<span class="nc" id="L419">                                  () -&gt; config.compact_tables_enabled,</span>
<span class="nc" id="L420">                                  x -&gt; config.compact_tables_enabled = x);</span>
<span class="nc" id="L421">    }</span>

    @Override
    public boolean getAlterTableEnabled()
    {
<span class="fc" id="L426">        return config.alter_table_enabled;</span>
    }

    public void setAlterTableEnabled(boolean enabled)
    {
<span class="nc" id="L431">        updatePropertyWithLogging(&quot;alter_table_enabled&quot;,</span>
<span class="nc" id="L432">                                  enabled,</span>
<span class="nc" id="L433">                                  () -&gt; config.alter_table_enabled,</span>
<span class="nc" id="L434">                                  x -&gt; config.alter_table_enabled = x);</span>
<span class="nc" id="L435">    }</span>

    @Override
    public boolean getReadBeforeWriteListOperationsEnabled()
    {
<span class="fc" id="L440">        return config.read_before_write_list_operations_enabled;</span>
    }

    public void setReadBeforeWriteListOperationsEnabled(boolean enabled)
    {
<span class="nc" id="L445">        updatePropertyWithLogging(&quot;read_before_write_list_operations_enabled&quot;,</span>
<span class="nc" id="L446">                                  enabled,</span>
<span class="nc" id="L447">                                  () -&gt; config.read_before_write_list_operations_enabled,</span>
<span class="nc" id="L448">                                  x -&gt; config.read_before_write_list_operations_enabled = x);</span>
<span class="nc" id="L449">    }</span>

    @Override
    public boolean getAllowFilteringEnabled()
    {
<span class="fc" id="L454">        return config.allow_filtering_enabled;</span>
    }

    public void setAllowFilteringEnabled(boolean enabled)
    {
<span class="nc" id="L459">        updatePropertyWithLogging(&quot;allow_filtering_enabled&quot;,</span>
<span class="nc" id="L460">                                  enabled,</span>
<span class="nc" id="L461">                                  () -&gt; config.allow_filtering_enabled,</span>
<span class="nc" id="L462">                                  x -&gt; config.allow_filtering_enabled = x);</span>
<span class="nc" id="L463">    }</span>

    @Override
    public boolean getSimpleStrategyEnabled()
    {
<span class="fc" id="L468">        return config.simplestrategy_enabled;</span>
    }

    public void setSimpleStrategyEnabled(boolean enabled)
    {
<span class="nc" id="L473">        updatePropertyWithLogging(&quot;simplestrategy_enabled&quot;,</span>
<span class="nc" id="L474">                                  enabled,</span>
<span class="nc" id="L475">                                  () -&gt; config.simplestrategy_enabled,</span>
<span class="nc" id="L476">                                  x -&gt; config.simplestrategy_enabled = x);</span>
<span class="nc" id="L477">    }</span>

    @Override
    public int getInSelectCartesianProductWarnThreshold()
    {
<span class="fc" id="L482">        return config.in_select_cartesian_product_warn_threshold;</span>
    }

    @Override
    public int getInSelectCartesianProductFailThreshold()
    {
<span class="fc" id="L488">        return config.in_select_cartesian_product_fail_threshold;</span>
    }

    public void setInSelectCartesianProductThreshold(int warn, int fail)
    {
<span class="nc" id="L493">        validateMaxIntThreshold(warn, fail, &quot;in_select_cartesian_product&quot;);</span>
<span class="nc" id="L494">        updatePropertyWithLogging(&quot;in_select_cartesian_product_warn_threshold&quot;,</span>
<span class="nc" id="L495">                                  warn,</span>
<span class="nc" id="L496">                                  () -&gt; config.in_select_cartesian_product_warn_threshold,</span>
<span class="nc" id="L497">                                  x -&gt; config.in_select_cartesian_product_warn_threshold = x);</span>
<span class="nc" id="L498">        updatePropertyWithLogging(&quot;in_select_cartesian_product_fail_threshold&quot;,</span>
<span class="nc" id="L499">                                  fail,</span>
<span class="nc" id="L500">                                  () -&gt; config.in_select_cartesian_product_fail_threshold,</span>
<span class="nc" id="L501">                                  x -&gt; config.in_select_cartesian_product_fail_threshold = x);</span>
<span class="nc" id="L502">    }</span>

    public Set&lt;ConsistencyLevel&gt; getReadConsistencyLevelsWarned()
    {
<span class="fc" id="L506">        return config.read_consistency_levels_warned;</span>
    }

    public void setReadConsistencyLevelsWarned(Set&lt;ConsistencyLevel&gt; consistencyLevels)
    {
<span class="nc" id="L511">        updatePropertyWithLogging(&quot;read_consistency_levels_warned&quot;,</span>
<span class="nc" id="L512">                                  validateConsistencyLevels(consistencyLevels, &quot;read_consistency_levels_warned&quot;),</span>
<span class="nc" id="L513">                                  () -&gt; config.read_consistency_levels_warned,</span>
<span class="nc" id="L514">                                  x -&gt; config.read_consistency_levels_warned = x);</span>
<span class="nc" id="L515">    }</span>

    @Override
    public Set&lt;ConsistencyLevel&gt; getReadConsistencyLevelsDisallowed()
    {
<span class="fc" id="L520">        return config.read_consistency_levels_disallowed;</span>
    }

    public void setReadConsistencyLevelsDisallowed(Set&lt;ConsistencyLevel&gt; consistencyLevels)
    {
<span class="nc" id="L525">        updatePropertyWithLogging(&quot;read_consistency_levels_disallowed&quot;,</span>
<span class="nc" id="L526">                                  validateConsistencyLevels(consistencyLevels, &quot;read_consistency_levels_disallowed&quot;),</span>
<span class="nc" id="L527">                                  () -&gt; config.read_consistency_levels_disallowed,</span>
<span class="nc" id="L528">                                  x -&gt; config.read_consistency_levels_disallowed = x);</span>
<span class="nc" id="L529">    }</span>

    @Override
    public Set&lt;ConsistencyLevel&gt; getWriteConsistencyLevelsWarned()
    {
<span class="fc" id="L534">        return config.write_consistency_levels_warned;</span>
    }

    public void setWriteConsistencyLevelsWarned(Set&lt;ConsistencyLevel&gt; consistencyLevels)
    {
<span class="nc" id="L539">        updatePropertyWithLogging(&quot;write_consistency_levels_warned&quot;,</span>
<span class="nc" id="L540">                                  validateConsistencyLevels(consistencyLevels, &quot;write_consistency_levels_warned&quot;),</span>
<span class="nc" id="L541">                                  () -&gt; config.write_consistency_levels_warned,</span>
<span class="nc" id="L542">                                  x -&gt; config.write_consistency_levels_warned = x);</span>
<span class="nc" id="L543">    }</span>

    @Override
    public Set&lt;ConsistencyLevel&gt; getWriteConsistencyLevelsDisallowed()
    {
<span class="fc" id="L548">        return config.write_consistency_levels_disallowed;</span>
    }

    public void setWriteConsistencyLevelsDisallowed(Set&lt;ConsistencyLevel&gt; consistencyLevels)
    {
<span class="nc" id="L553">        updatePropertyWithLogging(&quot;write_consistency_levels_disallowed&quot;,</span>
<span class="nc" id="L554">                                  validateConsistencyLevels(consistencyLevels, &quot;write_consistency_levels_disallowed&quot;),</span>
<span class="nc" id="L555">                                  () -&gt; config.write_consistency_levels_disallowed,</span>
<span class="nc" id="L556">                                  x -&gt; config.write_consistency_levels_disallowed = x);</span>
<span class="nc" id="L557">    }</span>

    @Override
    @Nullable
    public DataStorageSpec.LongBytesBound getPartitionSizeWarnThreshold()
    {
<span class="fc" id="L563">        return config.partition_size_warn_threshold;</span>
    }

    @Override
    @Nullable
    public DataStorageSpec.LongBytesBound getPartitionSizeFailThreshold()
    {
<span class="fc" id="L570">        return config.partition_size_fail_threshold;</span>
    }

    public void setPartitionSizeThreshold(@Nullable DataStorageSpec.LongBytesBound warn, @Nullable DataStorageSpec.LongBytesBound fail)
    {
<span class="fc" id="L575">        validateSizeThreshold(warn, fail, false, &quot;partition_size&quot;);</span>
<span class="fc" id="L576">        updatePropertyWithLogging(&quot;partition_size_warn_threshold&quot;,</span>
                                  warn,
<span class="fc" id="L578">                                  () -&gt; config.partition_size_warn_threshold,</span>
<span class="fc" id="L579">                                  x -&gt; config.partition_size_warn_threshold = x);</span>
<span class="fc" id="L580">        updatePropertyWithLogging(&quot;partition_size_fail_threshold&quot;,</span>
                                  fail,
<span class="fc" id="L582">                                  () -&gt; config.partition_size_fail_threshold,</span>
<span class="fc" id="L583">                                  x -&gt; config.partition_size_fail_threshold = x);</span>
<span class="fc" id="L584">    }</span>

    @Override
    public long getPartitionTombstonesWarnThreshold()
    {
<span class="fc" id="L589">        return config.partition_tombstones_warn_threshold;</span>
    }

    @Override
    public long getPartitionTombstonesFailThreshold()
    {
<span class="fc" id="L595">        return config.partition_tombstones_fail_threshold;</span>
    }

    public void setPartitionTombstonesThreshold(long warn, long fail)
    {
<span class="fc" id="L600">        validateMaxLongThreshold(warn, fail, &quot;partition_tombstones&quot;, false);</span>
<span class="fc" id="L601">        updatePropertyWithLogging(&quot;partition_tombstones_warn_threshold&quot;,</span>
<span class="fc" id="L602">                                  warn,</span>
<span class="fc" id="L603">                                  () -&gt; config.partition_tombstones_warn_threshold,</span>
<span class="fc" id="L604">                                  x -&gt; config.partition_tombstones_warn_threshold = x);</span>
<span class="fc" id="L605">        updatePropertyWithLogging(&quot;partition_tombstones_fail_threshold&quot;,</span>
<span class="fc" id="L606">                                  fail,</span>
<span class="fc" id="L607">                                  () -&gt; config.partition_tombstones_fail_threshold,</span>
<span class="fc" id="L608">                                  x -&gt; config.partition_tombstones_fail_threshold = x);</span>
<span class="fc" id="L609">    }</span>

    @Override
    @Nullable
    public DataStorageSpec.LongBytesBound getColumnValueSizeWarnThreshold()
    {
<span class="fc" id="L615">        return config.column_value_size_warn_threshold;</span>
    }

    @Override
    @Nullable
    public DataStorageSpec.LongBytesBound getColumnValueSizeFailThreshold()
    {
<span class="fc" id="L622">        return config.column_value_size_fail_threshold;</span>
    }

    public void setColumnValueSizeThreshold(@Nullable DataStorageSpec.LongBytesBound warn, @Nullable DataStorageSpec.LongBytesBound fail)
    {
<span class="nc" id="L627">        validateSizeThreshold(warn, fail, false, &quot;column_value_size&quot;);</span>
<span class="nc" id="L628">        updatePropertyWithLogging(&quot;column_value_size_warn_threshold&quot;,</span>
                                  warn,
<span class="nc" id="L630">                                  () -&gt; config.column_value_size_warn_threshold,</span>
<span class="nc" id="L631">                                  x -&gt; config.column_value_size_warn_threshold = x);</span>
<span class="nc" id="L632">        updatePropertyWithLogging(&quot;column_value_size_fail_threshold&quot;,</span>
                                  fail,
<span class="nc" id="L634">                                  () -&gt; config.column_value_size_fail_threshold,</span>
<span class="nc" id="L635">                                  x -&gt; config.column_value_size_fail_threshold = x);</span>
<span class="nc" id="L636">    }</span>

    @Override
    @Nullable
    public DataStorageSpec.LongBytesBound getCollectionSizeWarnThreshold()
    {
<span class="fc" id="L642">        return config.collection_size_warn_threshold;</span>
    }

    @Override
    @Nullable
    public DataStorageSpec.LongBytesBound getCollectionSizeFailThreshold()
    {
<span class="fc" id="L649">        return config.collection_size_fail_threshold;</span>
    }

    public void setCollectionSizeThreshold(@Nullable DataStorageSpec.LongBytesBound warn, @Nullable DataStorageSpec.LongBytesBound fail)
    {
<span class="nc" id="L654">        validateSizeThreshold(warn, fail, false, &quot;collection_size&quot;);</span>
<span class="nc" id="L655">        updatePropertyWithLogging(&quot;collection_size_warn_threshold&quot;,</span>
                                  warn,
<span class="nc" id="L657">                                  () -&gt; config.collection_size_warn_threshold,</span>
<span class="nc" id="L658">                                  x -&gt; config.collection_size_warn_threshold = x);</span>
<span class="nc" id="L659">        updatePropertyWithLogging(&quot;collection_size_fail_threshold&quot;,</span>
                                  fail,
<span class="nc" id="L661">                                  () -&gt; config.collection_size_fail_threshold,</span>
<span class="nc" id="L662">                                  x -&gt; config.collection_size_fail_threshold = x);</span>
<span class="nc" id="L663">    }</span>

    @Override
    public int getItemsPerCollectionWarnThreshold()
    {
<span class="fc" id="L668">        return config.items_per_collection_warn_threshold;</span>
    }

    @Override
    public int getItemsPerCollectionFailThreshold()
    {
<span class="fc" id="L674">        return config.items_per_collection_fail_threshold;</span>
    }

    public void setItemsPerCollectionThreshold(int warn, int fail)
    {
<span class="nc" id="L679">        validateMaxIntThreshold(warn, fail, &quot;items_per_collection&quot;);</span>
<span class="nc" id="L680">        updatePropertyWithLogging(&quot;items_per_collection_warn_threshold&quot;,</span>
<span class="nc" id="L681">                                  warn,</span>
<span class="nc" id="L682">                                  () -&gt; config.items_per_collection_warn_threshold,</span>
<span class="nc" id="L683">                                  x -&gt; config.items_per_collection_warn_threshold = x);</span>
<span class="nc" id="L684">        updatePropertyWithLogging(&quot;items_per_collection_fail_threshold&quot;,</span>
<span class="nc" id="L685">                                  fail,</span>
<span class="nc" id="L686">                                  () -&gt; config.items_per_collection_fail_threshold,</span>
<span class="nc" id="L687">                                  x -&gt; config.items_per_collection_fail_threshold = x);</span>
<span class="nc" id="L688">    }</span>

    @Override
    public int getFieldsPerUDTWarnThreshold()
    {
<span class="fc" id="L693">        return config.fields_per_udt_warn_threshold;</span>
    }

    @Override
    public int getFieldsPerUDTFailThreshold()
    {
<span class="fc" id="L699">        return config.fields_per_udt_fail_threshold;</span>
    }

    public void setFieldsPerUDTThreshold(int warn, int fail)
    {
<span class="nc" id="L704">        validateMaxIntThreshold(warn, fail, &quot;fields_per_udt&quot;);</span>
<span class="nc" id="L705">        updatePropertyWithLogging(&quot;fields_per_udt_warn_threshold&quot;,</span>
<span class="nc" id="L706">                                  warn,</span>
<span class="nc" id="L707">                                  () -&gt; config.fields_per_udt_warn_threshold,</span>
<span class="nc" id="L708">                                  x -&gt; config.fields_per_udt_warn_threshold = x);</span>
<span class="nc" id="L709">        updatePropertyWithLogging(&quot;fields_per_udt_fail_threshold&quot;,</span>
<span class="nc" id="L710">                                  fail,</span>
<span class="nc" id="L711">                                  () -&gt; config.fields_per_udt_fail_threshold,</span>
<span class="nc" id="L712">                                  x -&gt; config.fields_per_udt_fail_threshold = x);</span>
<span class="nc" id="L713">    }</span>

    @Override
    public int getVectorDimensionsWarnThreshold()
    {
<span class="fc" id="L718">        return config.vector_dimensions_warn_threshold;</span>
    }

    @Override
    public int getVectorDimensionsFailThreshold()
    {
<span class="fc" id="L724">        return config.vector_dimensions_fail_threshold;</span>
    }

    public void setVectorDimensionsThreshold(int warn, int fail)
    {
<span class="nc" id="L729">        validateMaxIntThreshold(warn, fail, &quot;vector_dimensions&quot;);</span>
<span class="nc" id="L730">        updatePropertyWithLogging(&quot;vector_dimensions_warn_threshold&quot;,</span>
<span class="nc" id="L731">                                  warn,</span>
<span class="nc" id="L732">                                  () -&gt; config.vector_dimensions_warn_threshold,</span>
<span class="nc" id="L733">                                  x -&gt; config.vector_dimensions_warn_threshold = x);</span>
<span class="nc" id="L734">        updatePropertyWithLogging(&quot;vector_dimensions_fail_threshold&quot;,</span>
<span class="nc" id="L735">                                  fail,</span>
<span class="nc" id="L736">                                  () -&gt; config.vector_dimensions_fail_threshold,</span>
<span class="nc" id="L737">                                  x -&gt; config.vector_dimensions_fail_threshold = x);</span>
<span class="nc" id="L738">    }</span>

    public int getDataDiskUsagePercentageWarnThreshold()
    {
<span class="fc" id="L742">        return config.data_disk_usage_percentage_warn_threshold;</span>
    }

    @Override
    public int getDataDiskUsagePercentageFailThreshold()
    {
<span class="fc" id="L748">        return config.data_disk_usage_percentage_fail_threshold;</span>
    }

    public void setDataDiskUsagePercentageThreshold(int warn, int fail)
    {
<span class="nc" id="L753">        validatePercentageThreshold(warn, fail, &quot;data_disk_usage_percentage&quot;);</span>
<span class="nc" id="L754">        updatePropertyWithLogging(&quot;data_disk_usage_percentage_warn_threshold&quot;,</span>
<span class="nc" id="L755">                                  warn,</span>
<span class="nc" id="L756">                                  () -&gt; config.data_disk_usage_percentage_warn_threshold,</span>
<span class="nc" id="L757">                                  x -&gt; config.data_disk_usage_percentage_warn_threshold = x);</span>
<span class="nc" id="L758">        updatePropertyWithLogging(&quot;data_disk_usage_percentage_fail_threshold&quot;,</span>
<span class="nc" id="L759">                                  fail,</span>
<span class="nc" id="L760">                                  () -&gt; config.data_disk_usage_percentage_fail_threshold,</span>
<span class="nc" id="L761">                                  x -&gt; config.data_disk_usage_percentage_fail_threshold = x);</span>
<span class="nc" id="L762">    }</span>

    @Override
    public DataStorageSpec.LongBytesBound getDataDiskUsageMaxDiskSize()
    {
<span class="fc" id="L767">        return config.data_disk_usage_max_disk_size;</span>
    }

    public void setDataDiskUsageMaxDiskSize(@Nullable DataStorageSpec.LongBytesBound diskSize)
    {
<span class="nc" id="L772">        validateDataDiskUsageMaxDiskSize(diskSize);</span>
<span class="nc" id="L773">        updatePropertyWithLogging(&quot;data_disk_usage_max_disk_size&quot;,</span>
                                  diskSize,
<span class="nc" id="L775">                                  () -&gt; config.data_disk_usage_max_disk_size,</span>
<span class="nc" id="L776">                                  x -&gt; config.data_disk_usage_max_disk_size = x);</span>
<span class="nc" id="L777">    }</span>

    @Override
    public int getMinimumReplicationFactorWarnThreshold()
    {
<span class="fc" id="L782">        return config.minimum_replication_factor_warn_threshold;</span>
    }

    @Override
    public int getMinimumReplicationFactorFailThreshold()
    {
<span class="fc" id="L788">        return config.minimum_replication_factor_fail_threshold;</span>
    }

    public void setMinimumReplicationFactorThreshold(int warn, int fail)
    {
<span class="nc" id="L793">        validateMinRFThreshold(warn, fail);</span>
<span class="nc" id="L794">        updatePropertyWithLogging(&quot;minimum_replication_factor_warn_threshold&quot;,</span>
<span class="nc" id="L795">                                  warn,</span>
<span class="nc" id="L796">                                  () -&gt; config.minimum_replication_factor_warn_threshold,</span>
<span class="nc" id="L797">                                  x -&gt; config.minimum_replication_factor_warn_threshold = x);</span>
<span class="nc" id="L798">        updatePropertyWithLogging(&quot;minimum_replication_factor_fail_threshold&quot;,</span>
<span class="nc" id="L799">                                  fail,</span>
<span class="nc" id="L800">                                  () -&gt; config.minimum_replication_factor_fail_threshold,</span>
<span class="nc" id="L801">                                  x -&gt; config.minimum_replication_factor_fail_threshold = x);</span>
<span class="nc" id="L802">    }</span>

    @Override
    public int getMaximumReplicationFactorWarnThreshold()
    {
<span class="fc" id="L807">        return config.maximum_replication_factor_warn_threshold;</span>
    }

    @Override
    public int getMaximumReplicationFactorFailThreshold()
    {
<span class="fc" id="L813">        return config.maximum_replication_factor_fail_threshold;</span>
    }

    public void setMaximumReplicationFactorThreshold(int warn, int fail)
    {
<span class="nc" id="L818">        validateMaxRFThreshold(warn, fail);</span>
<span class="nc" id="L819">        updatePropertyWithLogging(&quot;maximum_replication_factor_warn_threshold&quot;,</span>
<span class="nc" id="L820">                                  warn,</span>
<span class="nc" id="L821">                                  () -&gt; config.maximum_replication_factor_warn_threshold,</span>
<span class="nc" id="L822">                                  x -&gt; config.maximum_replication_factor_warn_threshold = x);</span>
<span class="nc" id="L823">        updatePropertyWithLogging(&quot;maximum_replication_factor_fail_threshold&quot;,</span>
<span class="nc" id="L824">                                  fail,</span>
<span class="nc" id="L825">                                  () -&gt; config.maximum_replication_factor_fail_threshold,</span>
<span class="nc" id="L826">                                  x -&gt; config.maximum_replication_factor_fail_threshold = x);</span>
<span class="nc" id="L827">    }</span>

    @Override
    public boolean getZeroTTLOnTWCSWarned()
    {
<span class="fc" id="L832">        return config.zero_ttl_on_twcs_warned;</span>
    }

    @Override
    public void setZeroTTLOnTWCSWarned(boolean value)
    {
<span class="nc" id="L838">        updatePropertyWithLogging(&quot;zero_ttl_on_twcs_warned&quot;,</span>
<span class="nc" id="L839">                                  value,</span>
<span class="nc" id="L840">                                  () -&gt; config.zero_ttl_on_twcs_warned,</span>
<span class="nc" id="L841">                                  x -&gt; config.zero_ttl_on_twcs_warned = x);</span>
<span class="nc" id="L842">    }</span>

    @Override
    public boolean getZeroTTLOnTWCSEnabled()
    {
<span class="fc" id="L847">        return config.zero_ttl_on_twcs_enabled;</span>
    }

    @Override
    public void setZeroTTLOnTWCSEnabled(boolean value)
    {
<span class="nc" id="L853">        updatePropertyWithLogging(&quot;zero_ttl_on_twcs_enabled&quot;,</span>
<span class="nc" id="L854">                                  value,</span>
<span class="nc" id="L855">                                  () -&gt; config.zero_ttl_on_twcs_enabled,</span>
<span class="nc" id="L856">                                  x -&gt; config.zero_ttl_on_twcs_enabled = x);</span>
<span class="nc" id="L857">    }</span>

    @Override
    public  DurationSpec.LongMicrosecondsBound getMaximumTimestampWarnThreshold()
    {
<span class="fc" id="L862">        return config.maximum_timestamp_warn_threshold;</span>
    }

    @Override
    public DurationSpec.LongMicrosecondsBound getMaximumTimestampFailThreshold()
    {
<span class="fc" id="L868">        return config.maximum_timestamp_fail_threshold;</span>
    }

    @Override
    public void setMaximumTimestampThreshold(@Nullable DurationSpec.LongMicrosecondsBound warn,
                                             @Nullable DurationSpec.LongMicrosecondsBound fail)
    {
<span class="nc" id="L875">        validateTimestampThreshold(warn, fail, &quot;maximum_timestamp&quot;);</span>

<span class="nc" id="L877">        updatePropertyWithLogging(&quot;maximum_timestamp_warn_threshold&quot;,</span>
                                  warn,
<span class="nc" id="L879">                                  () -&gt; config.maximum_timestamp_warn_threshold,</span>
<span class="nc" id="L880">                                  x -&gt; config.maximum_timestamp_warn_threshold = x);</span>

<span class="nc" id="L882">        updatePropertyWithLogging(&quot;maximum_timestamp_fail_threshold&quot;,</span>
                                  fail,
<span class="nc" id="L884">                                  () -&gt; config.maximum_timestamp_fail_threshold,</span>
<span class="nc" id="L885">                                  x -&gt; config.maximum_timestamp_fail_threshold = x);</span>
<span class="nc" id="L886">    }</span>

    @Override
    public  DurationSpec.LongMicrosecondsBound getMinimumTimestampWarnThreshold()
    {
<span class="fc" id="L891">        return config.minimum_timestamp_warn_threshold;</span>
    }

    @Override
    public DurationSpec.LongMicrosecondsBound getMinimumTimestampFailThreshold()
    {
<span class="fc" id="L897">        return config.minimum_timestamp_fail_threshold;</span>
    }

    @Override
    public void setMinimumTimestampThreshold(@Nullable DurationSpec.LongMicrosecondsBound warn,
                                             @Nullable DurationSpec.LongMicrosecondsBound fail)
    {
<span class="nc" id="L904">        validateTimestampThreshold(warn, fail, &quot;minimum_timestamp&quot;);</span>

<span class="nc" id="L906">        updatePropertyWithLogging(&quot;minimum_timestamp_warn_threshold&quot;,</span>
                                  warn,
<span class="nc" id="L908">                                  () -&gt; config.minimum_timestamp_warn_threshold,</span>
<span class="nc" id="L909">                                  x -&gt; config.minimum_timestamp_warn_threshold = x);</span>

<span class="nc" id="L911">        updatePropertyWithLogging(&quot;minimum_timestamp_fail_threshold&quot;,</span>
                                  fail,
<span class="nc" id="L913">                                  () -&gt; config.minimum_timestamp_fail_threshold,</span>
<span class="nc" id="L914">                                  x -&gt; config.minimum_timestamp_fail_threshold = x);</span>
<span class="nc" id="L915">    }</span>

    private static &lt;T&gt; void updatePropertyWithLogging(String propertyName, T newValue, Supplier&lt;T&gt; getter, Consumer&lt;T&gt; setter)
    {
<span class="fc" id="L919">        T oldValue = getter.get();</span>
<span class="pc bpc" id="L920" title="2 of 4 branches missed.">        if (newValue == null || !newValue.equals(oldValue))</span>
        {
<span class="fc" id="L922">            setter.accept(newValue);</span>
<span class="fc" id="L923">            logger.info(&quot;Updated {} from {} to {}&quot;, propertyName, oldValue, newValue);</span>
        }
<span class="fc" id="L925">    }</span>

    private static void validatePositiveNumeric(long value, long maxValue, String name)
    {
<span class="fc" id="L929">        validatePositiveNumeric(value, maxValue, name, false);</span>
<span class="fc" id="L930">    }</span>

    private static void validatePositiveNumeric(long value, long maxValue, String name, boolean allowZero)
    {
<span class="fc bfc" id="L934" title="All 2 branches covered.">        if (value == -1)</span>
<span class="fc" id="L935">            return;</span>

<span class="pc bpc" id="L937" title="1 of 2 branches missed.">        if (value &gt; maxValue)</span>
<span class="nc" id="L938">            throw new IllegalArgumentException(format(&quot;Invalid value %d for %s: maximum allowed value is %d&quot;,</span>
<span class="nc" id="L939">                                                      value, name, maxValue));</span>

<span class="pc bpc" id="L941" title="2 of 4 branches missed.">        if (!allowZero &amp;&amp; value == 0)</span>
<span class="nc" id="L942">            throw new IllegalArgumentException(format(&quot;Invalid value for %s: 0 is not allowed; &quot; +</span>
                                                      &quot;if attempting to disable use -1&quot;, name));

        // We allow -1 as a general &quot;disabling&quot; flag. But reject anything lower to avoid mistakes.
<span class="pc bpc" id="L946" title="1 of 2 branches missed.">        if (value &lt; 0)</span>
<span class="nc" id="L947">            throw new IllegalArgumentException(format(&quot;Invalid value %d for %s: negative values are not allowed, &quot; +</span>
<span class="nc" id="L948">                                                      &quot;outside of -1 which disables the guardrail&quot;, value, name));</span>
<span class="fc" id="L949">    }</span>

    private static void validatePercentage(long value, String name)
    {
<span class="fc" id="L953">        validatePositiveNumeric(value, 100, name);</span>
<span class="fc" id="L954">    }</span>

    private static void validatePercentageThreshold(int warn, int fail, String name)
    {
<span class="fc" id="L958">        validatePercentage(warn, name + &quot;_warn_threshold&quot;);</span>
<span class="fc" id="L959">        validatePercentage(fail, name + &quot;_fail_threshold&quot;);</span>
<span class="fc" id="L960">        validateWarnLowerThanFail(warn, fail, name);</span>
<span class="fc" id="L961">    }</span>

    private static void validateMaxIntThreshold(int warn, int fail, String name)
    {
<span class="fc" id="L965">        validatePositiveNumeric(warn, Integer.MAX_VALUE, name + &quot;_warn_threshold&quot;);</span>
<span class="fc" id="L966">        validatePositiveNumeric(fail, Integer.MAX_VALUE, name + &quot;_fail_threshold&quot;);</span>
<span class="fc" id="L967">        validateWarnLowerThanFail(warn, fail, name);</span>
<span class="fc" id="L968">    }</span>

    private static void validateMaxLongThreshold(long warn, long fail, String name, boolean allowZero)
    {
<span class="fc" id="L972">        validatePositiveNumeric(warn, Long.MAX_VALUE, name + &quot;_warn_threshold&quot;, allowZero);</span>
<span class="fc" id="L973">        validatePositiveNumeric(fail, Long.MAX_VALUE, name + &quot;_fail_threshold&quot;, allowZero);</span>
<span class="fc" id="L974">        validateWarnLowerThanFail(warn, fail, name);</span>
<span class="fc" id="L975">    }</span>

    private static void validateMinIntThreshold(int warn, int fail, String name)
    {
<span class="fc" id="L979">        validatePositiveNumeric(warn, Integer.MAX_VALUE, name + &quot;_warn_threshold&quot;);</span>
<span class="fc" id="L980">        validatePositiveNumeric(fail, Integer.MAX_VALUE, name + &quot;_fail_threshold&quot;);</span>
<span class="fc" id="L981">        validateWarnGreaterThanFail(warn, fail, name);</span>
<span class="fc" id="L982">    }</span>

    private static void validateMinRFThreshold(int warn, int fail)
    {
<span class="fc" id="L986">        validateMinIntThreshold(warn, fail, &quot;minimum_replication_factor&quot;);</span>

<span class="pc bpc" id="L988" title="1 of 2 branches missed.">        if (fail &gt; DatabaseDescriptor.getDefaultKeyspaceRF())</span>
<span class="nc" id="L989">            throw new IllegalArgumentException(format(&quot;minimum_replication_factor_fail_threshold to be set (%d) &quot; +</span>
                                                      &quot;cannot be greater than default_keyspace_rf (%d)&quot;,
<span class="nc" id="L991">                                                      fail, DatabaseDescriptor.getDefaultKeyspaceRF()));</span>
<span class="fc" id="L992">    }</span>

    private static void validateMaxRFThreshold(int warn, int fail)
    {
<span class="fc" id="L996">        validateMaxIntThreshold(warn, fail, &quot;maximum_replication_factor&quot;);</span>

<span class="pc bpc" id="L998" title="3 of 4 branches missed.">        if (fail != -1 &amp;&amp; fail &lt; DatabaseDescriptor.getDefaultKeyspaceRF())</span>
<span class="nc" id="L999">            throw new IllegalArgumentException(format(&quot;maximum_replication_factor_fail_threshold to be set (%d) &quot; +</span>
                                                      &quot;cannot be lesser than default_keyspace_rf (%d)&quot;,
<span class="nc" id="L1001">                                                      fail, DatabaseDescriptor.getDefaultKeyspaceRF()));</span>
<span class="fc" id="L1002">    }</span>

    public static void validateTimestampThreshold(DurationSpec.LongMicrosecondsBound warn,
                                                  DurationSpec.LongMicrosecondsBound fail,
                                                  String name)
    {
        // this function is used for both upper and lower thresholds because lower threshold is relative
        // despite using MinThreshold we still want the warn threshold to be less than or equal to
        // the fail threshold.
<span class="pc bpc" id="L1011" title="1 of 2 branches missed.">        validateMaxLongThreshold(warn == null ? -1 : warn.toMicroseconds(),</span>
<span class="pc bpc" id="L1012" title="1 of 2 branches missed.">                                 fail == null ? -1 : fail.toMicroseconds(),</span>
                                 name, true);
<span class="fc" id="L1014">    }</span>

    private static void validateWarnLowerThanFail(long warn, long fail, String name)
    {
<span class="fc bfc" id="L1018" title="All 4 branches covered.">        if (warn == -1 || fail == -1)</span>
<span class="fc" id="L1019">            return;</span>

<span class="pc bpc" id="L1021" title="1 of 2 branches missed.">        if (fail &lt; warn)</span>
<span class="nc" id="L1022">            throw new IllegalArgumentException(format(&quot;The warn threshold %d for %s_warn_threshold should be lower &quot; +</span>
<span class="nc" id="L1023">                                                      &quot;than the fail threshold %d&quot;, warn, name, fail));</span>
<span class="fc" id="L1024">    }</span>

    private static void validateWarnGreaterThanFail(long warn, long fail, String name)
    {
<span class="pc bpc" id="L1028" title="3 of 4 branches missed.">        if (warn == -1 || fail == -1)</span>
<span class="fc" id="L1029">            return;</span>

<span class="nc bnc" id="L1031" title="All 2 branches missed.">        if (fail &gt; warn)</span>
<span class="nc" id="L1032">            throw new IllegalArgumentException(format(&quot;The warn threshold %d for %s_warn_threshold should be greater &quot; +</span>
<span class="nc" id="L1033">                                                      &quot;than the fail threshold %d&quot;, warn, name, fail));</span>
<span class="nc" id="L1034">    }</span>

    private static void validateSize(DataStorageSpec.LongBytesBound size, boolean allowZero, String name)
    {
<span class="fc bfc" id="L1038" title="All 2 branches covered.">        if (size == null)</span>
<span class="fc" id="L1039">            return;</span>

<span class="pc bpc" id="L1041" title="2 of 4 branches missed.">        if (!allowZero &amp;&amp; size.toBytes() == 0)</span>
<span class="nc" id="L1042">            throw new IllegalArgumentException(format(&quot;Invalid value for %s: 0 is not allowed; &quot; +</span>
                                                      &quot;if attempting to disable use an empty value&quot;,
                                                      name));
<span class="fc" id="L1045">    }</span>

    private static void validateSizeThreshold(DataStorageSpec.LongBytesBound warn, DataStorageSpec.LongBytesBound fail, boolean allowZero, String name)
    {
<span class="fc" id="L1049">        validateSize(warn, allowZero, name + &quot;_warn_threshold&quot;);</span>
<span class="fc" id="L1050">        validateSize(fail, allowZero, name + &quot;_fail_threshold&quot;);</span>
<span class="fc" id="L1051">        validateWarnLowerThanFail(warn, fail, name);</span>
<span class="fc" id="L1052">    }</span>

    private static void validateWarnLowerThanFail(DataStorageSpec.LongBytesBound warn, DataStorageSpec.LongBytesBound fail, String name)
    {
<span class="pc bpc" id="L1056" title="1 of 4 branches missed.">        if (warn == null || fail == null)</span>
<span class="fc" id="L1057">            return;</span>

<span class="pc bpc" id="L1059" title="1 of 2 branches missed.">        if (fail.toBytes() &lt; warn.toBytes())</span>
<span class="nc" id="L1060">            throw new IllegalArgumentException(format(&quot;The warn threshold %s for %s_warn_threshold should be lower &quot; +</span>
                                                      &quot;than the fail threshold %s&quot;, warn, name, fail));
<span class="fc" id="L1062">    }</span>

    private static Set&lt;String&gt; validateTableProperties(Set&lt;String&gt; properties, String name)
    {
<span class="pc bpc" id="L1066" title="1 of 2 branches missed.">        if (properties == null)</span>
<span class="nc" id="L1067">            throw new IllegalArgumentException(format(&quot;Invalid value for %s: null is not allowed&quot;, name));</span>

<span class="fc" id="L1069">        Set&lt;String&gt; lowerCaseProperties = properties.stream().map(String::toLowerCase).collect(toSet());</span>

<span class="fc" id="L1071">        Set&lt;String&gt; diff = Sets.difference(lowerCaseProperties, TableAttributes.allKeywords());</span>

<span class="pc bpc" id="L1073" title="1 of 2 branches missed.">        if (!diff.isEmpty())</span>
<span class="nc" id="L1074">            throw new IllegalArgumentException(format(&quot;Invalid value for %s: '%s' do not parse as valid table properties&quot;,</span>
                                                      name, diff));

<span class="fc" id="L1077">        return lowerCaseProperties;</span>
    }

    private static Set&lt;ConsistencyLevel&gt; validateConsistencyLevels(Set&lt;ConsistencyLevel&gt; consistencyLevels, String name)
    {
<span class="pc bpc" id="L1082" title="1 of 2 branches missed.">        if (consistencyLevels == null)</span>
<span class="nc" id="L1083">            throw new IllegalArgumentException(format(&quot;Invalid value for %s: null is not allowed&quot;, name));</span>

<span class="pc bpc" id="L1085" title="1 of 2 branches missed.">        return consistencyLevels.isEmpty() ? Collections.emptySet() : Sets.immutableEnumSet(consistencyLevels);</span>
    }

    private static void validateDataDiskUsageMaxDiskSize(DataStorageSpec.LongBytesBound maxDiskSize)
    {
<span class="pc bpc" id="L1090" title="1 of 2 branches missed.">        if (maxDiskSize == null)</span>
<span class="fc" id="L1091">            return;</span>

<span class="nc" id="L1093">        validateSize(maxDiskSize, false, &quot;data_disk_usage_max_disk_size&quot;);</span>

<span class="nc" id="L1095">        long diskSize = DiskUsageMonitor.totalDiskSpace();</span>

<span class="nc bnc" id="L1097" title="All 2 branches missed.">        if (diskSize &lt; maxDiskSize.toBytes())</span>
<span class="nc" id="L1098">            throw new IllegalArgumentException(format(&quot;Invalid value for data_disk_usage_max_disk_size: &quot; +</span>
                                                      &quot;%s specified, but only %s are actually available on disk&quot;,
<span class="nc" id="L1100">                                                      maxDiskSize, FileUtils.stringifyFileSize(diskSize)));</span>
<span class="nc" id="L1101">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>